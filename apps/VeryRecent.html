<!DOCTYPE html>
<html lang="en" prefix="og: https://ogp.me/ns#">
<head>
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GOOGLE ANALYTICS 4 â€” GA4 ID: G-6EGC5ZNZPF
       GDPR/CCPA Consent-First: analytics_storage denied by default.
       Only activates after user accepts cookie banner.
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('consent', 'default', {
      analytics_storage: 'denied',
      ad_storage: 'denied',
      wait_for_update: 500
    });
    gtag('js', new Date());
    gtag('config', 'G-6EGC5ZNZPF', { anonymize_ip: true, send_page_view: false });

    function loadAnalytics() {
      // GA4 â€” G-6EGC5ZNZPF
      const s = document.createElement('script');
      s.async = true;
      s.src = 'https://www.googletagmanager.com/gtag/js?id=G-6EGC5ZNZPF';
      document.head.appendChild(s);
      s.onload = () => {
        gtag('consent', 'update', { analytics_storage: 'granted' });
        gtag('event', 'page_view', {
          page_title: document.title,
          page_location: window.location.href
        });
      };

      // Microsoft Clarity â€” ID: vhyrbjp63x
      // Only loads after user consent (GDPR/CCPA compliant)
      (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window,document,"clarity","script","vhyrbjp63x");
    }
  </script>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CORE META â€” CHARSET, VIEWPORT, COMPATIBILITY
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta http-equiv="Content-Language" content="en">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SEO FUNDAMENTALS â€” TITLE, DESCRIPTION, KEYWORDS
       (Google recommends 50â€“60 char titles, 150â€“160 char descriptions)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <title>Music Theory Explorer Pro | Keys, Codes &amp; Modes</title>
  <meta name="description" content="Free interactive music theory tool. Explore chromatic circles, piano keyboard, guitar fretboard, scales, chords, modes &amp; ear training. Visual music education by Keys, Codes &amp; Modes.">
  <meta name="keywords" content="music theory, chromatic circle, circle of fifths, music scales, guitar chords, piano chords, modes, ear training, music education, interactive music, keys codes modes, Ben Ryan, FreeStyle guitar">
  <meta name="author" content="Ben Ryan â€” Keys, Codes &amp; Modes">
  <meta name="copyright" content="Â© 2025 Ben Ryan â€” Keys, Codes &amp; Modes. All rights reserved.">
  <meta name="language" content="English">
  <meta name="revisit-after" content="7 days">
  <meta name="rating" content="general">
  <meta name="category" content="Music Education, Interactive Learning">
  <meta name="classification" content="Education">
  <meta name="subject" content="Music Theory Education">
  <meta name="coverage" content="Worldwide">
  <meta name="distribution" content="Global">
  <meta name="target" content="all">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ROBOTS â€” GOOGLE + ALL SEARCH ENGINES
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow">
  <meta name="slurp" content="index, follow">
  <meta name="duckduckbot" content="index, follow">
  <meta name="msnbot" content="index, follow">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CANONICAL + ALTERNATE URLS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <link rel="canonical" href="https://keyscodesandmodes.com/music-theory-explorer">
  <link rel="alternate" hreflang="en" href="https://keyscodesandmodes.com/music-theory-explorer">
  <link rel="alternate" hreflang="x-default" href="https://keyscodesandmodes.com/music-theory-explorer">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MICROSOFT / BING SEO
       Bing Webmaster Tools verification â€” replace content value
       with your actual Bing verification code from:
       https://www.bing.com/webmasters/about
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <meta name="msvalidate.01" content="REPLACE_WITH_BING_VERIFICATION_CODE">
  <meta name="msapplication-TileColor" content="#0d1117">
  <meta name="msapplication-TileImage" content="https://keyscodesandmodes.com/assets/ms-tile-144.png">
  <meta name="msapplication-config" content="https://keyscodesandmodes.com/browserconfig.xml">
  <meta name="msapplication-tooltip" content="Music Theory Explorer Pro â€” Keys, Codes &amp; Modes">
  <meta name="msapplication-starturl" content="https://keyscodesandmodes.com/music-theory-explorer">
  <meta name="msapplication-navbutton-color" content="#2dd4bf">
  <meta name="msapplication-window" content="width=1024;height=768">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GOOGLE SITE VERIFICATION
       Replace with your actual code from Google Search Console:
       https://search.google.com/search-console
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <meta name="google-site-verification" content="REPLACE_WITH_GOOGLE_VERIFICATION_CODE">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       YANDEX VERIFICATION (optional international reach)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <meta name="yandex-verification" content="REPLACE_WITH_YANDEX_CODE">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       OPEN GRAPH â€” FACEBOOK, LINKEDIN, WHATSAPP, DISCORD
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Music Theory Explorer Pro | Keys, Codes &amp; Modes">
  <meta property="og:description" content="Master music theory interactively. Chromatic circles, piano, guitar, scales, chords, modes &amp; ear training â€” all in one visual tool. Free.">
  <meta property="og:url" content="https://keyscodesandmodes.com/music-theory-explorer">
  <meta property="og:site_name" content="Keys, Codes &amp; Modes">
  <meta property="og:image" content="https://keyscodesandmodes.com/assets/og-music-theory-1200x630.jpg">
  <meta property="og:image:secure_url" content="https://keyscodesandmodes.com/assets/og-music-theory-1200x630.jpg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:type" content="image/jpeg">
  <meta property="og:image:alt" content="Music Theory Explorer Pro â€” chromatic circle showing all 12 notes in vivid color">
  <meta property="og:locale" content="en_US">
  <meta property="og:updated_time" content="2025-02-14T00:00:00+00:00">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TWITTER / X CARD
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@KeysCodesAndModes">
  <meta name="twitter:creator" content="@BenRyanMusic">
  <meta name="twitter:title" content="Music Theory Explorer Pro | Keys, Codes &amp; Modes">
  <meta name="twitter:description" content="Free interactive music theory â€” chromatic circle, piano, guitar, modes &amp; ear training. Visual learning tool.">
  <meta name="twitter:image" content="https://keyscodesandmodes.com/assets/og-music-theory-1200x630.jpg">
  <meta name="twitter:image:alt" content="Music Theory Explorer Pro chromatic circle interface">
  <meta name="twitter:domain" content="keyscodesandmodes.com">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       THEME / APP / PWA COLORS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <meta name="theme-color" content="#0d1117" media="(prefers-color-scheme: dark)">
  <meta name="theme-color" content="#0d1117">
  <meta name="color-scheme" content="dark">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Music Theory">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Music Theory Explorer">
  <meta name="format-detection" content="telephone=no">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       STRUCTURED DATA â€” SCHEMA.ORG JSON-LD
       Multiple schemas for maximum rich result eligibility
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

  <!-- Schema 1: WebApplication -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "@id": "https://keyscodesandmodes.com/music-theory-explorer#webapp",
    "name": "Music Theory Explorer Pro",
    "description": "Interactive music education tool for learning scales, chords, modes, and intervals using visual chromatic circles, piano keyboard, and guitar fretboard.",
    "url": "https://keyscodesandmodes.com/music-theory-explorer",
    "applicationCategory": "EducationApplication",
    "applicationSubCategory": "Music Education",
    "operatingSystem": "Windows, macOS, iOS, Android, Linux, ChromeOS",
    "browserRequirements": "Requires JavaScript ES6+ and Web Audio API. Supports Chrome 60+, Firefox 60+, Safari 11+, Edge 79+.",
    "softwareVersion": "2.0",
    "releaseNotes": "Added two-column layout, MIDI support, recording studio, chord progressions",
    "screenshot": "https://keyscodesandmodes.com/assets/screenshot-music-theory.jpg",
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD",
      "availability": "https://schema.org/InStock"
    },
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.9",
      "reviewCount": "127",
      "bestRating": "5",
      "worstRating": "1"
    },
    "creator": {
      "@type": "Person",
      "@id": "https://keyscodesandmodes.com/#ben-ryan",
      "name": "Ben Ryan",
      "givenName": "Ben",
      "familyName": "Ryan",
      "jobTitle": "Music Educator, Inventor & Technologist",
      "url": "https://keyscodesandmodes.com/about.html",
      "sameAs": [
        "https://keyscodesandmodes.com"
      ]
    },
    "publisher": {
      "@type": "Organization",
      "@id": "https://keyscodesandmodes.com/#organization",
      "name": "Keys, Codes & Modes",
      "url": "https://keyscodesandmodes.com",
      "logo": {
        "@type": "ImageObject",
        "url": "https://keyscodesandmodes.com/assets/logo.png",
        "width": 400,
        "height": 100
      },
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "customer support",
        "url": "https://keyscodesandmodes.com/contact.html"
      }
    },
    "keywords": "music theory, chromatic circle, guitar chords, piano scales, modes, ear training, FreeStyle guitar",
    "inLanguage": "en-US",
    "isAccessibleForFree": true,
    "accessibilityFeature": [
      "alternativeText",
      "captions",
      "keyboardNavigation",
      "structuredNavigation",
      "highContrastDisplay",
      "largePrint"
    ],
    "accessibilityHazard": "none",
    "accessibilityControl": [
      "fullKeyboardControl",
      "fullMouseControl",
      "fullTouchControl"
    ],
    "accessMode": ["textual", "visual", "auditory"],
    "featureList": [
      "Chromatic Circle Visualization",
      "Piano Keyboard Trainer",
      "Guitar Fretboard Navigator",
      "Ear Training Quiz",
      "Scale & Mode Explorer",
      "Chord Progression Player",
      "MIDI Input Support",
      "Recording Studio",
      "Harmonized Major & Minor Scales",
      "All 7 Musical Modes",
      "Free Play Mode"
    ],
    "datePublished": "2024-01-01",
    "dateModified": "2025-02-14"
  }
  </script>

  <!-- Schema 2: Organization -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "@id": "https://keyscodesandmodes.com/#organization",
    "name": "Keys, Codes & Modes",
    "alternateName": "KCM",
    "url": "https://keyscodesandmodes.com",
    "logo": "https://keyscodesandmodes.com/assets/logo.png",
    "description": "Visual music education platform founded by Ben Ryan, inventor of the FreeStyleÂ® Musical Device.",
    "founder": {
      "@type": "Person",
      "name": "Ben Ryan"
    },
    "foundingDate": "2020",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "Santa Barbara",
      "addressRegion": "CA",
      "addressCountry": "US"
    },
    "contactPoint": {
      "@type": "ContactPoint",
      "contactType": "General Inquiries",
      "url": "https://keyscodesandmodes.com/contact.html",
      "availableLanguage": "English"
    },
    "sameAs": [
      "https://keyscodesandmodes.com"
    ]
  }
  </script>

  <!-- Schema 3: BreadcrumbList for this page -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "https://keyscodesandmodes.com/index.html"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "All Apps",
        "item": "https://keyscodesandmodes.com/my-apps.html"
      },
      {
        "@type": "ListItem",
        "position": 3,
        "name": "Music Theory Explorer Pro",
        "item": "https://keyscodesandmodes.com/music-theory-explorer"
      }
    ]
  }
  </script>

  <!-- Schema 4: FAQPage â€” boosts search rich snippets -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": [
      {
        "@type": "Question",
        "name": "Is Music Theory Explorer Pro free to use?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes, Music Theory Explorer Pro is completely free to use. No account required. Access chromatic circles, piano, guitar fretboard, ear training and more at no cost."
        }
      },
      {
        "@type": "Question",
        "name": "What music theory concepts does this tool cover?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "The tool covers single notes, intervals, triads, seventh chords, pentatonic scales, major and minor scales, all 7 modes (Ionian through Locrian), harmonized major and minor scales, and free play. It includes ear training quizzes and chord progression practice."
        }
      },
      {
        "@type": "Question",
        "name": "Does it support MIDI instruments?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "Yes. Music Theory Explorer Pro supports Web MIDI API. Connect any MIDI-compatible instrument and the chromatic circle, piano, and guitar fretboard will respond to your playing in real time."
        }
      }
    ]
  }
  </script>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PRIVACY / COMPLIANCE META
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- GDPR: Signals data processing purpose to compatible crawlers -->
  <meta name="privacy-policy" content="https://keyscodesandmodes.com/privacy.html">
  <meta name="terms-of-service" content="https://keyscodesandmodes.com/terms.html">
  <!-- DNT (Do Not Track) â€” declared but enforced via JS consent logic -->
  <meta http-equiv="P3P" content='CP="This site does not have a P3P policy."'>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SITEMAP HINT FOR CRAWLERS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <link rel="sitemap" type="application/xml" title="Sitemap" href="https://keyscodesandmodes.com/sitemap.xml">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PERFORMANCE â€” PRECONNECT & FONTS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://www.googletagmanager.com">
  <link rel="dns-prefetch" href="https://www.google-analytics.com">
  <link rel="dns-prefetch" href="https://www.bing.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Outfit:wght@300;400;600;700;900&display=swap" rel="stylesheet">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FAVICONS / PWA / APP ICONS
       (Place actual icon files at these paths on your server)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸµ</text></svg>">
  <link rel="apple-touch-icon" sizes="180x180" href="https://keyscodesandmodes.com/assets/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://keyscodesandmodes.com/assets/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://keyscodesandmodes.com/assets/favicon-16x16.png">
  <link rel="manifest" href="https://keyscodesandmodes.com/manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Music Theory">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Music Theory Explorer">
  <meta name="format-detection" content="telephone=no">

  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CSS CUSTOM PROPERTIES (DESIGN TOKENS)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      --bg-deep:      #080c12;
      --bg-surface:   #0d1117;
      --bg-card:      #111827;
      --bg-raised:    #1c2433;
      --border:       rgba(255,255,255,0.07);
      --border-glow:  rgba(255,255,255,0.15);
      --text-primary: #f0f4f8;
      --text-secondary: #8899aa;
      --accent-gold:  #f5c842;
      --accent-teal:  #2dd4bf;
      --accent-rose:  #fb7185;
      --accent-blue:  #60a5fa;
      --accent-green: #34d399;
      --radius-sm:    8px;
      --radius-md:    14px;
      --radius-lg:    20px;
      --radius-xl:    28px;
      --shadow-sm:    0 2px 8px rgba(0,0,0,0.3);
      --shadow-md:    0 8px 24px rgba(0,0,0,0.4);
      --shadow-lg:    0 16px 48px rgba(0,0,0,0.6);
      --transition:   all 0.2s cubic-bezier(0.4,0,0.2,1);
      --font-display: 'DM Serif Display', Georgia, serif;
      --font-body:    'Outfit', system-ui, sans-serif;
      --safe-top:     env(safe-area-inset-top, 0px);
      --safe-bottom:  env(safe-area-inset-bottom, 0px);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESET & BASE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    *, *::before, *::after {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    html {
      scroll-behavior: smooth;
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }
    body {
      margin: 0;
      padding: 0;
      background: var(--bg-deep);
      color: var(--text-primary);
      font-family: var(--font-body);
      font-size: clamp(14px, 2vw, 16px);
      line-height: 1.6;
      min-height: 100vh;
      min-height: 100dvh;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    *:focus-visible {
      outline: 2px solid var(--accent-teal);
      outline-offset: 3px;
      border-radius: 4px;
    }
    *:not(:focus-visible) { outline: none; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SKIP NAVIGATION (ACCESSIBILITY)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .skip-nav {
      position: absolute;
      top: -100px;
      left: 16px;
      background: var(--accent-teal);
      color: var(--bg-deep);
      padding: 10px 18px;
      border-radius: var(--radius-sm);
      font-weight: 700;
      font-size: 14px;
      z-index: 9999;
      transition: top 0.2s;
      text-decoration: none;
    }
    .skip-nav:focus { top: 16px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ANIMATED BACKGROUND
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse 800px 600px at 20% 10%, rgba(45,212,191,0.06) 0%, transparent 60%),
        radial-gradient(ellipse 600px 800px at 80% 90%, rgba(96,165,250,0.05) 0%, transparent 60%),
        radial-gradient(ellipse 400px 400px at 50% 50%, rgba(245,200,66,0.03) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LAYOUT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .page-wrapper {
      position: relative;
      z-index: 1;
      max-width: 1440px;
      margin: 0 auto;
      padding: clamp(12px, 3vw, 32px);
      padding-top: calc(clamp(12px,3vw,32px) + var(--safe-top));
      padding-bottom: calc(clamp(16px,4vw,40px) + var(--safe-bottom));
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       COOKIE CONSENT BANNER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #cookie-banner {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--bg-card);
      border-top: 1px solid var(--border-glow);
      padding: 16px clamp(16px,4vw,40px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
      z-index: 9000;
      box-shadow: 0 -8px 32px rgba(0,0,0,0.5);
      transform: translateY(100%);
      transition: transform 0.4s cubic-bezier(0.4,0,0.2,1);
    }
    #cookie-banner.show { transform: translateY(0); }
    #cookie-banner p {
      margin: 0;
      font-size: 13px;
      color: var(--text-secondary);
      max-width: 700px;
    }
    #cookie-banner a { color: var(--accent-teal); text-decoration: none; }
    #cookie-banner a:hover { text-decoration: underline; }
    .cookie-btns { display: flex; gap: 10px; flex-shrink: 0; }
    .cookie-btn {
      padding: 8px 20px;
      border-radius: var(--radius-sm);
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      border: none;
      transition: var(--transition);
    }
    .cookie-btn.accept {
      background: var(--accent-teal);
      color: var(--bg-deep);
    }
    .cookie-btn.accept:hover { filter: brightness(1.1); }
    .cookie-btn.decline {
      background: var(--bg-raised);
      color: var(--text-secondary);
      border: 1px solid var(--border);
    }
    .cookie-btn.decline:hover { background: var(--bg-surface); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HEADER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .site-header {
      text-align: center;
      margin-bottom: clamp(20px, 4vw, 40px);
      padding: clamp(24px, 4vw, 44px) clamp(20px, 4vw, 48px);
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border);
      position: relative;
      overflow: hidden;
    }
    .site-header::before {
      content: '';
      position: absolute;
      inset: -2px;
      background: linear-gradient(135deg, rgba(45,212,191,0.15), transparent 40%, rgba(96,165,250,0.1));
      border-radius: inherit;
      pointer-events: none;
    }
    .site-header h1 {
      margin: 0 0 10px;
      font-family: var(--font-display);
      font-size: clamp(26px, 5vw, 52px);
      font-weight: 400;
      letter-spacing: -0.02em;
      background: linear-gradient(135deg, var(--accent-gold) 0%, #fff 50%, var(--accent-teal) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      line-height: 1.1;
    }
    .site-header p {
      margin: 0;
      font-size: clamp(12px, 1.8vw, 15px);
      color: var(--text-secondary);
      font-weight: 400;
      letter-spacing: 0.03em;
    }
    .badge-row {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 14px;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 4px 12px;
      background: rgba(255,255,255,0.05);
      border: 1px solid var(--border);
      border-radius: 100px;
      font-size: 11px;
      font-weight: 600;
      color: var(--text-secondary);
      letter-spacing: 0.04em;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AUDIO START BUTTON
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .audio-start-wrap { text-align: center; margin-bottom: 24px; }
    #startAudio {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: clamp(14px,2vw,18px) clamp(32px,4vw,56px);
      font-family: var(--font-body);
      font-size: clamp(15px,2vw,19px);
      font-weight: 700;
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      color: white;
      border: 2px solid rgba(255,255,255,0.25);
      border-radius: var(--radius-lg);
      cursor: pointer;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      box-shadow: 0 8px 32px rgba(231,76,60,0.4), 0 0 0 0 rgba(231,76,60,0.4);
      animation: pulse-ring 2.5s ease-in-out infinite;
      transition: var(--transition);
      touch-action: manipulation;
    }
    #startAudio:hover { transform: scale(1.03); filter: brightness(1.1); }
    #startAudio:disabled {
      background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
      box-shadow: 0 8px 32px rgba(39,174,96,0.4);
      animation: none;
    }
    @keyframes pulse-ring {
      0%, 100% { box-shadow: 0 8px 32px rgba(231,76,60,0.4), 0 0 0 0 rgba(231,76,60,0.3); }
      50%       { box-shadow: 0 8px 32px rgba(231,76,60,0.4), 0 0 0 12px rgba(231,76,60,0); }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       STATUS BAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #status {
      font-size: clamp(13px,1.8vw,16px);
      font-weight: 600;
      text-align: center;
      padding: 12px 20px;
      background: var(--bg-raised);
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      color: var(--accent-teal);
      margin-bottom: 20px;
      letter-spacing: 0.02em;
      min-height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       NAV / TAB BAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .tab-nav {
      display: flex;
      gap: clamp(6px,1vw,10px);
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 20px;
      background: var(--bg-card);
      padding: 10px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
    }
    .view-btn {
      flex: 0 1 auto;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: clamp(9px,1.5vw,12px) clamp(14px,2vw,22px);
      background: transparent;
      border: 1px solid transparent;
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      cursor: pointer;
      font-family: var(--font-body);
      font-weight: 600;
      font-size: clamp(12px,1.5vw,14px);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      transition: var(--transition);
      touch-action: manipulation;
      min-height: 44px;
      white-space: nowrap;
    }
    .view-btn:hover {
      color: var(--text-primary);
      background: var(--bg-raised);
    }
    .view-btn.active {
      background: var(--bg-raised);
      border-color: var(--accent-teal);
      color: var(--accent-teal);
      box-shadow: 0 0 12px rgba(45,212,191,0.2);
    }
    [role="tablist"] { role: tablist; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LEVEL SELECTOR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .level-selector {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
      background: var(--bg-card);
      padding: clamp(12px,2vw,20px) clamp(14px,2vw,24px);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      margin-bottom: 20px;
    }
    .level-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: clamp(8px,1vw,11px) clamp(14px,1.8vw,20px);
      background: var(--bg-raised);
      border: 1px solid var(--border);
      border-radius: 100px;
      color: var(--text-secondary);
      cursor: pointer;
      font-family: var(--font-body);
      font-size: clamp(11px,1.3vw,13px);
      font-weight: 700;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      transition: var(--transition);
      touch-action: manipulation;
      min-height: 40px;
      white-space: nowrap;
    }
    .level-btn:hover {
      color: var(--text-primary);
      border-color: var(--border-glow);
      transform: translateY(-1px);
    }
    .level-btn.active {
      background: linear-gradient(135deg, var(--accent-rose), #e85d79);
      border-color: var(--accent-rose);
      color: white;
      box-shadow: 0 4px 16px rgba(251,113,133,0.35);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CARD / INFO PANEL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .card {
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border);
      padding: clamp(16px,3vw,32px);
      margin-bottom: 20px;
      box-shadow: var(--shadow-md);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PROGRESSION CONTROLS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* #progressionControls styles handled by .ctrl-section in new layout */
    #progressionControls h4 { display: none; /* replaced by ctrl-section-header */ }
    .progression-meta {
      text-align: center;
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 14px;
    }
    .progression-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PLAYBACK CONTROLS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .play-controls {
      display: flex;
      gap: 8px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .play-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: clamp(10px,1.5vw,13px) clamp(18px,2vw,26px);
      background: linear-gradient(135deg, #27ae60 0%, #1e9953 100%);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: var(--radius-md);
      color: white;
      cursor: pointer;
      font-family: var(--font-body);
      font-weight: 700;
      font-size: clamp(12px,1.4vw,14px);
      letter-spacing: 0.04em;
      text-transform: uppercase;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
      touch-action: manipulation;
      min-height: 44px;
    }
    .play-btn:hover { transform: translateY(-2px); filter: brightness(1.12); }
    .play-btn:active { transform: scale(0.97); }
    .play-btn-secondary {
      background: linear-gradient(135deg, var(--accent-blue), #3b82f6);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       OCTAVE CONTROLS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .octave-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }
    .octave-btn {
      padding: 10px 18px;
      background: var(--bg-raised);
      border: 1px solid var(--border-glow);
      border-radius: var(--radius-md);
      color: var(--accent-blue);
      font-family: var(--font-body);
      font-weight: 700;
      font-size: 13px;
      cursor: pointer;
      transition: var(--transition);
      min-height: 44px;
      touch-action: manipulation;
    }
    .octave-btn:hover { background: var(--accent-blue); color: white; }
    .octave-display {
      background: var(--bg-raised);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 10px 20px;
      text-align: center;
      min-width: 180px;
      font-size: 13px;
      font-weight: 600;
    }
    .octave-display small { display: block; font-size: 10px; color: var(--text-secondary); margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.06em; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TEMPO CONTROL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .tempo-row {
      display: flex;
      justify-content: center;
      margin-bottom: 16px;
    }
    .tempo-control {
      background: var(--bg-raised);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 12px 20px;
      width: min(340px, 100%);
      text-align: center;
    }
    .tempo-control label {
      display: block;
      font-size: 10px;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 8px;
    }
    .tempo-slider-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .tempo-label { font-size: 11px; font-weight: 700; color: var(--text-secondary); min-width: 36px; }
    .bpm-display { font-size: 18px; font-weight: 900; color: var(--accent-gold); margin-top: 4px; }

    input[type="range"] {
      flex: 1;
      -webkit-appearance: none;
      appearance: none;
      height: 5px;
      border-radius: 100px;
      background: linear-gradient(to right, var(--accent-blue), var(--accent-rose));
      cursor: pointer;
      outline: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: white;
      border: 2px solid var(--accent-blue);
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    }
    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: white;
      border: 2px solid var(--accent-blue);
      cursor: pointer;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CHROMATIC CIRCLE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .circle-wrap {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: clamp(10px,2vw,20px) 0;
    }
    #chromaticCircle {
      position: relative;
      width: min(480px, 90vw);
      height: min(480px, 90vw);
      background: radial-gradient(circle at 40% 35%, #1a2840 0%, #0a0f18 100%);
      border-radius: 50%;
      border: 2px solid var(--border-glow);
      box-shadow: 0 0 60px rgba(45,212,191,0.08), var(--shadow-lg);
    }
    #staffNotation {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: clamp(160px,36%,230px);
      height: clamp(140px,32%,190px);
      background: rgba(252,252,252,0.97);
      border-radius: 10px;
      padding: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.7);
      pointer-events: none;
      border: 3px solid var(--accent-teal);
      z-index: 10;
      overflow: hidden;
    }
    #staffNotation svg { width: 100%; height: 100%; }
    .staff-header {
      background: linear-gradient(135deg, #e74c3c, #c0392b);
      color: white;
      padding: 5px 8px;
      border-radius: 6px 6px 0 0;
      margin: -12px -12px 6px;
      text-align: center;
      font-size: 11px;
      font-weight: 800;
      letter-spacing: 0.04em;
    }

    .sphere {
      position: absolute;
      width: clamp(54px, 12%, 68px);
      height: clamp(54px, 12%, 68px);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-body);
      font-weight: 700;
      font-size: clamp(11px,2.5%,15px);
      cursor: pointer;
      border: 3px solid rgba(255,255,255,0.5);
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      transition: transform 0.2s, box-shadow 0.2s;
      user-select: none;
      touch-action: manipulation;
      white-space: pre-line;
      text-align: center;
      line-height: 1.2;
    }
    .sphere:hover { transform: scale(1.15) !important; }
    .sphere.active {
      border-color: #ffff00;
      box-shadow: 0 0 24px rgba(255,255,0,0.7), 0 4px 12px rgba(0,0,0,0.5);
      transform: scale(1.22) !important;
    }
    .sphere.included { transform: scale(1.08) !important; }
    .sphere.excluded { opacity: 0.25; filter: grayscale(80%) brightness(0.5); transform: scale(0.9) !important; }
    .sphere.playing {
      border-color: #fff !important;
      box-shadow: 0 0 30px rgba(255,255,255,0.9), 0 0 60px currentColor !important;
      transform: scale(1.35) !important;
      animation: sphere-pulse 0.3s ease-out;
    }
    .sphere.freeplay-inactive { opacity: 1; filter: none; }
    @keyframes sphere-pulse {
      0% { transform: scale(1) !important; }
      60% { transform: scale(1.45) !important; }
      100% { transform: scale(1.35) !important; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PIANO KEYBOARD
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #pianoKeyboard {
      display: block;
      padding: clamp(16px,3vw,32px);
      text-align: center;
    }
    #pianoKeyboard h2 {
      font-family: var(--font-display);
      font-size: clamp(18px,2.5vw,26px);
      font-weight: 400;
      margin: 0 0 20px;
      color: var(--accent-gold);
    }
    .piano-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; padding-bottom: 10px; }
    .piano-container {
      position: relative;
      height: clamp(140px, 22vw, 200px);
      display: inline-flex;
      min-width: max-content;
    }
    .white-key {
      width: clamp(36px, 6vw, 52px);
      height: 100%;
      background: linear-gradient(to bottom, #fff 0%, #eee 100%);
      border: 2px solid #444;
      border-radius: 0 0 6px 6px;
      cursor: pointer;
      position: relative;
      transition: var(--transition);
      touch-action: manipulation;
    }
    .white-key:hover { background: linear-gradient(to bottom, #f0f0f0 0%, #ddd 100%); transform: translateY(-2px); }
    .white-key.playing {
      transform: translateY(3px) !important;
      box-shadow: inset 0 4px 8px rgba(0,0,0,0.3) !important;
      animation: key-flash 0.25s ease;
    }
    .black-key {
      width: clamp(22px, 4vw, 34px);
      height: 60%;
      background: linear-gradient(180deg, #222 0%, #000 100%);
      border: 2px solid #000;
      border-radius: 0 0 5px 5px;
      cursor: pointer;
      position: absolute;
      z-index: 2;
      transition: var(--transition);
      touch-action: manipulation;
      box-shadow: 0 4px 8px rgba(0,0,0,0.6);
    }
    .black-key:hover { background: linear-gradient(180deg, #333 0%, #111 100%); transform: translateY(-2px); }
    .black-key.playing {
      transform: translateY(3px) !important;
      animation: key-flash 0.25s ease;
    }
    @keyframes key-flash {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.4); }
    }
    .key-label {
      position: absolute;
      bottom: 7px;
      width: 100%;
      text-align: center;
      font-size: clamp(8px,1.2vw,11px);
      font-weight: 700;
      pointer-events: none;
      color: #333;
    }
    .black-key .key-label { color: rgba(255,255,255,0.8); bottom: 4px; font-size: 8px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GUITAR FRETBOARD
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #guitarFretboard {
      display: block;
      padding: clamp(16px,3vw,32px);
    }
    #guitarFretboard h2 {
      font-family: var(--font-display);
      font-size: clamp(18px,2.5vw,26px);
      font-weight: 400;
      text-align: center;
      margin: 0 0 16px;
      color: var(--accent-gold);
    }
    .fret-toggle-row { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; }
    .fretboard-scroll { overflow-x: auto; -webkit-overflow-scrolling: touch; display: flex; justify-content: center; }
    .fretboard-container {
      background: linear-gradient(to bottom, #8B4513 0%, #A0522D 100%);
      border-radius: 4px;
      padding: 6px 12px 4px;
      display: inline-block;
    }
    .fretboard {
      position: relative;
      width: 180px;
      background: linear-gradient(to right, #D2691E 0%, #8B4513 50%, #654321 100%);
      border-radius: 2px;
      border: 1px solid #654321;
      cursor: pointer;
      transition: height 0.3s ease;
    }
    .guitar-string {
      position: absolute;
      height: 100%;
      top: 0;
    }
    .fret-wire { position: absolute; width: 100%; height: 3px; background: linear-gradient(to right, #888 0%, #aaa 50%, #888 100%); left: 0; }
    .note-dot {
      position: absolute;
      width: clamp(24px,4vw,30px);
      height: clamp(24px,4vw,30px);
      border-radius: 50%;
      border: 2px solid white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(8px,1.5vw,11px);
      font-weight: 700;
      cursor: pointer;
      transform: translate(-50%, -50%);
      transition: var(--transition);
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      user-select: none;
      touch-action: manipulation;
    }
    .note-dot:hover { transform: translate(-50%, -50%) scale(1.2); }
    .note-dot.playing {
      box-shadow: 0 0 20px rgba(255,255,255,1) !important;
      transform: translate(-50%, -50%) scale(1.4) !important;
    }
    .string-label {
      position: absolute;
      top: -56px;
      font-weight: 700;
      font-size: clamp(22px,4vw,30px);
      color: white;
      text-align: center;
      width: 36px;
      height: 36px;
      cursor: pointer;
      z-index: 500;
      transition: color 0.2s, transform 0.2s;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      touch-action: manipulation;
    }
    .string-label:hover { color: var(--accent-gold); transform: scale(1.3); }
    .guitar-info { text-align: center; margin-bottom: 50px; }
    .guitar-info p { margin: 4px 0; font-size: 13px; }
    .guitar-info .hint { color: var(--accent-green); font-weight: 600; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       EAR TRAINING
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #earTraining {
      display: block;
      padding: clamp(16px,3vw,32px);
      text-align: center;
      max-width: 700px;
      margin: 0 auto;
    }
    #quizQuestion {
      font-family: var(--font-display);
      font-size: clamp(18px,3vw,26px);
      font-weight: 400;
      margin-bottom: 20px;
      color: var(--text-primary);
    }
    .quiz-options { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin: 20px 0; }
    .quiz-btn {
      padding: clamp(11px,1.5vw,14px) clamp(18px,2vw,26px);
      background: var(--bg-raised);
      border: 1px solid var(--border-glow);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      cursor: pointer;
      font-family: var(--font-body);
      font-weight: 700;
      font-size: 13px;
      letter-spacing: 0.03em;
      text-transform: uppercase;
      transition: var(--transition);
      min-height: 48px;
      touch-action: manipulation;
    }
    .quiz-btn:hover { background: var(--accent-blue); border-color: var(--accent-blue); color: white; }
    .quiz-btn.correct { background: linear-gradient(135deg, #27ae60, #1e9953); border-color: #27ae60; color: white; animation: correct-bounce 0.5s ease; }
    .quiz-btn.incorrect { background: linear-gradient(135deg, #e74c3c, #c0392b); border-color: #e74c3c; color: white; animation: shake 0.5s ease; }
    @keyframes correct-bounce { 0%,100%{transform:scale(1)} 50%{transform:scale(1.08)} }
    @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-6px)} 75%{transform:translateX(6px)} }
    #quizScore { font-size: clamp(16px,2.5vw,22px); font-weight: 700; color: var(--accent-gold); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       NOTE BADGES
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .note-list { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-top: 12px; }
    .note-badge {
      padding: 8px 16px;
      border-radius: 100px;
      background: var(--bg-raised);
      font-size: 13px;
      font-weight: 700;
      border: 1px solid var(--border-glow);
      letter-spacing: 0.04em;
      text-transform: uppercase;
      transition: var(--transition);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CONTROLS (DROPDOWNS)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .control-group { margin-bottom: 14px; }
    .control-group label {
      display: block;
      font-size: 11px;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 7px;
    }
    select {
      width: 100%;
      padding: 10px 14px;
      background: var(--bg-raised);
      border: 1px solid var(--border-glow);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-family: var(--font-body);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      appearance: none;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%238899aa' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 36px;
    }
    select:focus { border-color: var(--accent-teal); box-shadow: 0 0 0 3px rgba(45,212,191,0.15); }
    select option { background: #1c2433; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FREEPLAY HINT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .freeplay-hint {
      background: linear-gradient(135deg, rgba(245,200,66,0.15), rgba(245,200,66,0.05));
      border: 1px solid rgba(245,200,66,0.3);
      padding: 14px 18px;
      border-radius: var(--radius-md);
      margin-bottom: 16px;
      text-align: center;
      font-weight: 600;
      font-size: clamp(12px,1.5vw,14px);
      color: var(--accent-gold);
      display: none;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RECORDING STUDIO
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .studio-section {
      background: var(--bg-raised);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: clamp(16px,2vw,24px);
      margin-top: 20px;
    }
    .studio-section h3 {
      font-family: var(--font-display);
      font-weight: 400;
      font-size: clamp(16px,2vw,20px);
      text-align: center;
      margin: 0 0 16px;
      color: var(--accent-teal);
    }
    .studio-btns { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-bottom: 12px; }
    .rec-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 11px 20px;
      border: 1px solid var(--border-glow);
      border-radius: var(--radius-md);
      color: white;
      cursor: pointer;
      font-family: var(--font-body);
      font-weight: 700;
      font-size: 13px;
      background: var(--bg-raised);
      transition: var(--transition);
      touch-action: manipulation;
      min-height: 44px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .rec-btn:hover { transform: translateY(-2px); filter: brightness(1.2); }
    .rec-btn.recording { background: linear-gradient(135deg, #e74c3c, #c0392b); animation: blink 1.2s infinite; border-color: #e74c3c; }
    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.6} }
    #recordingStatus { text-align: center; font-size: 13px; color: var(--text-secondary); min-height: 20px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       KEYBOARD SHORTCUTS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .shortcuts-section {
      background: var(--bg-raised);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 16px 20px;
      margin-top: 16px;
    }
    .shortcuts-section h4 {
      font-size: 12px;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin: 0 0 12px;
    }
    .shortcuts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 8px;
    }
    .shortcut-item { display: flex; align-items: center; gap: 8px; font-size: 12px; }
    kbd {
      background: var(--bg-card);
      border: 1px solid var(--border-glow);
      border-bottom-width: 2px;
      border-radius: 5px;
      padding: 2px 8px;
      font-family: monospace;
      font-size: 11px;
      font-weight: 700;
      color: var(--accent-blue);
      white-space: nowrap;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       INTERVAL POPUP
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #intervalPopup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg-card);
      border: 1px solid var(--border-glow);
      color: var(--text-primary);
      padding: clamp(24px,4vw,36px) clamp(28px,5vw,48px);
      border-radius: var(--radius-xl);
      box-shadow: 0 24px 80px rgba(0,0,0,0.7);
      z-index: 10000;
      text-align: center;
      max-width: min(500px, 90vw);
      width: 100%;
      display: none;
      animation: popup-in 0.25s cubic-bezier(0.34,1.56,0.64,1);
    }
    #intervalPopup::before {
      content: '';
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: -1;
    }
    @keyframes popup-in { 0%{transform:translate(-50%,-50%) scale(0.8);opacity:0} 100%{transform:translate(-50%,-50%) scale(1);opacity:1} }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FOOTER â€” FULLY REDESIGNED, ALL LINKS, FULL COMPLIANCE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .site-footer {
      margin-top: 48px;
      background: var(--bg-card);
      border-top: 1px solid var(--border-glow);
      color: var(--text-secondary);
      font-size: 13px;
      position: relative;
      overflow: hidden;
    }
    .site-footer::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(90deg,
        var(--accent-rose) 0%,
        var(--accent-gold) 25%,
        var(--accent-teal) 50%,
        var(--accent-blue) 75%,
        var(--accent-rose) 100%);
      background-size: 200% 100%;
      animation: footer-bar 6s linear infinite;
    }
    @keyframes footer-bar {
      0%   { background-position: 0% 0%; }
      100% { background-position: 200% 0%; }
    }

    /* Footer top grid */
    .footer-grid {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr;
      gap: 32px;
      padding: clamp(32px,5vw,56px) clamp(20px,4vw,48px) clamp(24px,4vw,40px);
      max-width: 1440px;
      margin: 0 auto;
    }
    @media (max-width: 900px) {
      .footer-grid { grid-template-columns: 1fr 1fr; gap: 24px; }
    }
    @media (max-width: 540px) {
      .footer-grid { grid-template-columns: 1fr; gap: 20px; }
    }

    /* Brand column */
    .footer-brand {}
    .footer-logo {
      font-family: var(--font-display);
      font-size: clamp(18px,2.5vw,24px);
      font-weight: 400;
      color: var(--text-primary);
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-teal));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      display: inline-block;
      margin-bottom: 10px;
    }
    .footer-brand-desc {
      font-size: 12px;
      line-height: 1.7;
      color: var(--text-secondary);
      max-width: 260px;
      margin-bottom: 16px;
    }
    .footer-compliance-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .compliance-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 9px;
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      border-radius: 100px;
      font-size: 10px;
      font-weight: 700;
      color: var(--text-secondary);
      letter-spacing: 0.04em;
      text-transform: uppercase;
      white-space: nowrap;
    }
    .compliance-badge.badge-green { border-color: rgba(52,211,153,0.3); color: var(--accent-green); }
    .compliance-badge.badge-blue  { border-color: rgba(96,165,250,0.3); color: var(--accent-blue);  }
    .compliance-badge.badge-gold  { border-color: rgba(245,200,66,0.3);  color: var(--accent-gold);  }
    .compliance-badge.badge-teal  { border-color: rgba(45,212,191,0.3);  color: var(--accent-teal);  }

    /* Footer nav columns */
    .footer-col-title {
      font-size: 10px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-primary);
      margin-bottom: 14px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
    }
    .footer-nav-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .footer-nav-list li a {
      display: flex;
      align-items: center;
      gap: 7px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 12px;
      font-weight: 500;
      transition: color 0.2s, gap 0.2s;
      line-height: 1.4;
    }
    .footer-nav-list li a:hover {
      color: var(--accent-teal);
      gap: 10px;
    }
    .footer-nav-list li a .fnav-icon {
      font-size: 12px;
      flex-shrink: 0;
      width: 16px;
      text-align: center;
    }

    /* Footer bottom bar */
    .footer-bottom {
      border-top: 1px solid var(--border);
      padding: 18px clamp(20px,4vw,48px);
      max-width: 1440px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
    }
    .footer-bottom-left {
      font-size: 11px;
      color: var(--text-secondary);
      opacity: 0.7;
      line-height: 1.6;
    }
    .footer-bottom-left strong { color: var(--text-primary); opacity: 1; }
    .footer-bottom-right {
      display: flex;
      align-items: center;
      gap: 14px;
      flex-wrap: wrap;
    }
    .footer-legal-links {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
    }
    .footer-legal-links a {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 11px;
      font-weight: 600;
      transition: color 0.2s;
      opacity: 0.7;
    }
    .footer-legal-links a:hover { color: var(--accent-teal); opacity: 1; }
    .footer-accessibility-link {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 4px 10px;
      background: rgba(45,212,191,0.08);
      border: 1px solid rgba(45,212,191,0.2);
      border-radius: 100px;
      color: var(--accent-teal);
      text-decoration: none;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      transition: var(--transition);
    }
    .footer-accessibility-link:hover { background: rgba(45,212,191,0.15); }

    /* Accessibility statement section */
    .footer-a11y-bar {
      background: rgba(45,212,191,0.04);
      border-top: 1px solid rgba(45,212,191,0.1);
      padding: 12px clamp(20px,4vw,48px);
      text-align: center;
      font-size: 11px;
      color: var(--text-secondary);
      line-height: 1.7;
    }
    .footer-a11y-bar a { color: var(--accent-teal); text-decoration: none; }
    .footer-a11y-bar a:hover { text-decoration: underline; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VISUALLY HIDDEN (ACCESSIBILITY)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .sr-only {
      position: absolute;
      width: 1px; height: 1px;
      padding: 0; margin: -1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      white-space: nowrap;
      border: 0;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       REDUCED MOTION
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { animation-duration: 0.001ms !important; transition-duration: 0.001ms !important; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PRINT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media print {
      #cookie-banner, #startAudio, .tab-nav, .level-selector, .studio-section, .shortcuts-section { display: none !important; }
      body { background: white; color: black; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESPONSIVE FINE-TUNING
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TWO-COLUMN APP LAYOUT
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .app-layout {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 20px;
      align-items: start;
    }

    /* â”€â”€â”€ VIEWER COLUMN â”€â”€â”€ */
    .viewer-col {
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-width: 0;
    }

    .viewer-card {
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      border: 1px solid var(--border);
      overflow: hidden;
      box-shadow: var(--shadow-lg);
      position: relative;
    }

    .view-panel { display: none; }
    .view-panel.active-panel { display: block; }
    .view-panel[hidden] { display: none !important; }

    .panel-title {
      font-family: var(--font-display);
      font-size: clamp(16px,2.2vw,22px);
      font-weight: 400;
      text-align: center;
      margin: 0 0 16px;
      color: var(--accent-gold);
      padding-top: 20px;
    }

    .note-list-row {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: 14px 16px;
      min-height: 52px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* â”€â”€â”€ CONTROLS COLUMN â”€â”€â”€ */
    .controls-col {
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: sticky;
      top: 16px;
      max-height: calc(100vh - 32px);
      overflow-y: auto;
      overflow-x: hidden;
      scrollbar-width: thin;
      scrollbar-color: var(--border-glow) transparent;
    }
    .controls-col::-webkit-scrollbar { width: 4px; }
    .controls-col::-webkit-scrollbar-track { background: transparent; }
    .controls-col::-webkit-scrollbar-thumb { background: var(--border-glow); border-radius: 2px; }

    /* â”€â”€â”€ CONTROL SECTIONS â”€â”€â”€ */
    .ctrl-section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .ctrl-section-header {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      background: var(--bg-raised);
      border-bottom: 1px solid var(--border);
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-secondary);
    }

    .ctrl-section-icon {
      font-size: 14px;
      line-height: 1;
    }

    .ctrl-section > .level-selector,
    .ctrl-section > #controls,
    .ctrl-section > .octave-row,
    .ctrl-section > .tempo-control,
    .ctrl-section > .play-grid,
    .ctrl-section > .rec-grid {
      padding: 12px 14px;
    }

    /* Level selector inside ctrl-section */
    .ctrl-section .level-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      padding: 12px 14px;
      border: none;
      background: transparent;
      margin: 0;
      border-radius: 0;
    }

    .ctrl-section .level-btn {
      flex: 0 1 auto;
      font-size: 10px;
      padding: 6px 11px;
      min-height: 32px;
    }

    /* Octave row in sidebar */
    .ctrl-section .octave-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 14px;
      flex-wrap: nowrap;
    }
    .ctrl-section .octave-display {
      flex: 1;
      min-width: 0;
      text-align: center;
      font-size: 11px;
    }
    .ctrl-section .octave-display small {
      font-size: 9px;
    }
    .ctrl-section .octave-btn {
      padding: 8px 12px;
      font-size: 16px;
      min-height: 36px;
      flex-shrink: 0;
    }

    /* Tempo in sidebar */
    .ctrl-section .tempo-control {
      padding: 8px 14px 12px;
      border-top: 1px solid var(--border);
    }
    .ctrl-section .tempo-control label {
      font-size: 10px;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      display: block;
      margin-bottom: 6px;
    }
    .ctrl-section .bpm-display {
      font-size: 15px;
      font-weight: 900;
      color: var(--accent-gold);
      text-align: center;
      margin-top: 4px;
    }
    .ctrl-section .tempo-slider-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .ctrl-section .tempo-label {
      font-size: 9px;
      color: var(--text-secondary);
      font-weight: 600;
      min-width: 20px;
    }

    /* 2Ã—2 play button grid */
    .play-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      padding: 8px 14px 14px;
      border-top: 1px solid var(--border);
    }
    .play-grid .play-btn {
      font-size: 11px;
      padding: 9px 8px;
      min-height: 38px;
      letter-spacing: 0.02em;
    }

    /* Dynamic controls */
    #dynamicControls #controls {
      padding: 8px 14px 12px;
    }
    #dynamicControls #controls:empty::before {
      content: 'Select a mode above';
      font-size: 12px;
      color: var(--text-secondary);
      font-style: italic;
      display: block;
      padding: 8px 14px 12px;
    }
    #dynamicControls .control-group {
      margin-bottom: 10px;
    }
    #dynamicControls .control-group label {
      font-size: 10px;
    }
    #dynamicControls select {
      font-size: 12px;
      padding: 8px 32px 8px 10px;
    }

    /* Progression section */
    #progressionControls .progression-meta {
      padding: 6px 14px;
      font-size: 11px;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border);
    }
    #progressionControls .play-btn-blue {
      display: block;
      margin: 10px 14px 0;
      width: calc(100% - 28px);
    }
    #progressionControls .progression-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      padding: 10px 14px 14px;
    }
    #progressionControls .progression-buttons .level-btn {
      font-size: 10px;
      padding: 6px 10px;
      min-height: 32px;
      flex: 1 1 calc(50% - 5px);
    }

    /* Rec buttons 2Ã—2 grid */
    .rec-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      padding: 12px 14px;
    }
    .rec-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
      padding: 9px 10px;
      border: 1px solid var(--border-glow);
      border-radius: var(--radius-md);
      color: white;
      cursor: pointer;
      font-family: var(--font-body);
      font-weight: 700;
      font-size: 12px;
      background: var(--bg-raised);
      transition: var(--transition);
      min-height: 38px;
      touch-action: manipulation;
      letter-spacing: 0.03em;
    }
    .rec-btn:hover { transform: translateY(-1px); filter: brightness(1.2); }
    .rec-btn.recording { background: linear-gradient(135deg,#e74c3c,#c0392b); animation: blink 1.2s infinite; }
    .rec-btn.rec-green { background: linear-gradient(135deg,#27ae60,#1e9953); border-color: #27ae60; }
    .rec-btn.rec-orange { background: linear-gradient(135deg,#e67e22,#d35400); border-color: #e67e22; }
    .rec-btn.rec-purple { background: linear-gradient(135deg,#9b59b6,#8e44ad); border-color: #9b59b6; }
    .rec-status {
      text-align: center;
      font-size: 11px;
      color: var(--text-secondary);
      padding: 0 14px 10px;
      min-height: 18px;
    }

    /* Compact shortcuts */
    .ctrl-section-compact .shortcuts-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
      padding: 10px 14px 14px;
    }
    .ctrl-section-compact .shortcut-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
    }

    /* Play button extras */
    .play-btn-purple { background: linear-gradient(135deg,#9b59b6,#8e44ad) !important; }
    .play-btn-blue { background: linear-gradient(135deg,var(--accent-blue),#3b82f6) !important; }
    .quiz-score-display { font-size: clamp(16px,2vw,20px); font-weight: 700; color: var(--accent-gold); text-align: center; margin-top: 8px; }
    .open-strings-label { color: white; font-weight: 600; font-size: 13px; margin: 0; }

    /* â”€â”€â”€ RESPONSIVE: TABLET / MOBILE â”€â”€â”€ */
    @media (max-width: 900px) {
      .app-layout {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      .controls-col {
        position: static;
        max-height: none;
        overflow: visible;
      }
    }

    @media (max-width: 480px) {
      .play-grid { grid-template-columns: 1fr 1fr; gap: 5px; }
      .play-grid .play-btn { font-size: 10px; padding: 8px 5px; }
      .rec-grid { grid-template-columns: 1fr 1fr; }
    }

    /* Tab nav compact on viewer col */
    .viewer-col .tab-nav {
      padding: 7px;
      gap: 5px;
    }
    .viewer-col .view-btn {
      flex: 1;
      padding: 9px 8px;
      font-size: 11px;
      gap: 4px;
    }
    @media (max-width: 500px) {
      .tab-label { display: none; }
      .viewer-col .view-btn { font-size: 16px; padding: 8px; }
    }
  </style>
</head>

<body>
  <a class="skip-nav" href="#main-content">Skip to main content</a>

  <!-- COOKIE CONSENT -->
  <div id="cookie-banner" role="dialog" aria-labelledby="cookie-title" aria-describedby="cookie-desc">
    <p id="cookie-desc">
      <strong id="cookie-title">We respect your privacy.</strong>
      This site uses Google Analytics to understand how visitors use Music Theory Explorer Pro.
      No personal data is sold. See our <a href="#privacy-policy" aria-label="Privacy Policy">Privacy Policy</a>.
    </p>
    <div class="cookie-btns">
      <button class="cookie-btn decline" id="cookieDecline" type="button">Decline</button>
      <button class="cookie-btn accept" id="cookieAccept" type="button">Accept Analytics</button>
    </div>
  </div>

  <div class="page-wrapper">

    <!-- â•â•â• HEADER â•â•â• -->
    <header class="site-header" role="banner">
      <h1>ğŸµ Music Theory Explorer Pro</h1>
      <p>Interactive Visual Music Education Â· Keys, Codes &amp; Modes</p>
      <div class="badge-row" aria-label="Features">
        <span class="badge">â­• Chromatic Circle</span>
        <span class="badge">ğŸ¹ Piano</span>
        <span class="badge">ğŸ¸ Guitar</span>
        <span class="badge">ğŸ‘‚ Ear Training</span>
        <span class="badge">ğŸ› MIDI</span>
        <span class="badge">âœ¦ Free</span>
      </div>
    </header>

    <!-- â•â•â• AUDIO START â•â•â• -->
    <div class="audio-start-wrap">
      <button id="startAudio" type="button" aria-label="Start audio engine">
        <span aria-hidden="true">ğŸ”Š</span> Start Audio Engine
      </button>
    </div>

    <!-- â•â•â• MAIN TWO-COLUMN LAYOUT â•â•â• -->
    <main id="main-content" role="main" class="app-layout">

      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           LEFT COLUMN â€” VIEWER
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="viewer-col">

        <!-- View Tab Nav -->
        <nav class="tab-nav" aria-label="View selector" role="tablist">
          <button class="view-btn active" data-view="circle" role="tab" aria-selected="true" id="tab-circle">
            <span aria-hidden="true">â­•</span><span class="tab-label">Circle</span>
          </button>
          <button class="view-btn" data-view="guitar" role="tab" aria-selected="false" id="tab-guitar">
            <span aria-hidden="true">ğŸ¸</span><span class="tab-label">Guitar</span>
          </button>
          <button class="view-btn" data-view="keyboard" role="tab" aria-selected="false" id="tab-keyboard">
            <span aria-hidden="true">ğŸ¹</span><span class="tab-label">Piano</span>
          </button>
          <button class="view-btn" data-view="ear" role="tab" aria-selected="false" id="tab-ear">
            <span aria-hidden="true">ğŸ‘‚</span><span class="tab-label">Ear</span>
          </button>
        </nav>

        <!-- Status Display -->
        <div id="status" role="status" aria-live="polite" aria-atomic="true">
          Click <strong>Start Audio Engine</strong> to begin!
        </div>

        <!-- Freeplay Hint -->
        <div class="freeplay-hint" id="freeplayHint" role="note" aria-live="polite">
          ğŸ¨ <strong>Free Play:</strong> Click multiple notes, then play as CHORD or SEQUENCE!
        </div>

        <!-- â”€â”€â”€ VIEWER CARD â”€â”€â”€ -->
        <div class="viewer-card" id="viewerCard">

          <!-- CIRCLE VIEW -->
          <div id="panel-circle" role="tabpanel" aria-labelledby="tab-circle" class="view-panel active-panel">
            <div class="circle-wrap">
              <div id="chromaticCircle" aria-label="Chromatic circle" role="group">
                <div id="staffNotation" aria-hidden="true">
                  <div class="staff-header">ğŸ¼ STAFF NOTATION</div>
                  <svg id="staffSVG" viewBox="0 0 220 135" role="img" aria-label="Staff notation"></svg>
                </div>
              </div>
            </div>
          </div>

          <!-- PIANO VIEW -->
          <div id="panel-keyboard" role="tabpanel" aria-labelledby="tab-keyboard" class="view-panel" hidden>
            <div id="pianoKeyboard">
              <h2 class="panel-title">ğŸ¹ Piano Keyboard</h2>
              <div class="piano-scroll">
                <div class="piano-container" id="pianoContainer" role="group" aria-label="Piano keyboard"></div>
              </div>
            </div>
          </div>

          <!-- GUITAR VIEW -->
          <div id="panel-guitar" role="tabpanel" aria-labelledby="tab-guitar" class="view-panel" hidden>
            <div id="guitarFretboard">
              <h2 class="panel-title">ğŸ¸ Guitar Fretboard â€” Standard Tuning</h2>
              <div class="fret-toggle-row" role="group" aria-label="Fret count">
                <button class="level-btn" id="fret3Btn" type="button" aria-pressed="false">3 Frets</button>
                <button class="level-btn active" id="fret5Btn" type="button" aria-pressed="true">5 Frets</button>
                <button class="level-btn" id="fret12Btn" type="button" aria-pressed="false">12 Frets</button>
              </div>
              <div class="guitar-info">
                <p class="hint">Active notes light up â€” click dots or strings to play</p>
                <p class="open-strings-label">OPEN STRINGS (0 fret)</p>
              </div>
              <div class="fretboard-scroll">
                <div class="fretboard-container">
                  <div class="fretboard" id="fretboard" role="group" aria-label="Guitar fretboard"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- EAR TRAINING VIEW -->
          <div id="panel-ear" role="tabpanel" aria-labelledby="tab-ear" class="view-panel" hidden>
            <div id="earTraining">
              <h2 id="quizQuestion" aria-live="polite" class="panel-title">Click "New Question" to start</h2>
              <div class="quiz-options" id="quizOptions" role="group" aria-label="Answer choices"></div>
              <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin:12px 0;">
                <button class="play-btn" id="playQuizBtn" type="button">ğŸ”Š Replay</button>
                <button class="play-btn play-btn-purple" id="newQuizBtn" type="button">ğŸ”„ New Question</button>
              </div>
              <p id="quizScore" aria-live="polite" class="quiz-score-display">Score: 0/0</p>
            </div>
          </div>

        </div><!-- /viewer-card -->

        <!-- Note List (below viewer) -->
        <div class="note-list-row">
          <div class="note-list" id="noteList" aria-live="polite" aria-label="Selected notes"></div>
        </div>

      </div><!-- /viewer-col -->


      <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RIGHT COLUMN â€” CONTROLS
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
      <div class="controls-col">

        <!-- â”€ SECTION: MODE / LEVEL â”€ -->
        <div class="ctrl-section">
          <div class="ctrl-section-header">
            <span class="ctrl-section-icon">ğŸ“</span>
            <span>Theory Mode</span>
          </div>
          <div class="level-selector" aria-label="Music theory mode selector">
            <button class="level-btn active" data-level="1" aria-pressed="true">Single Note</button>
            <button class="level-btn" data-level="2" aria-pressed="false">Intervals</button>
            <button class="level-btn" data-level="3" aria-pressed="false">Triads</button>
            <button class="level-btn" data-level="4" aria-pressed="false">7th Chords</button>
            <button class="level-btn" data-level="5" aria-pressed="false">Pentatonic</button>
            <button class="level-btn" data-level="7" aria-pressed="false">Major Scale</button>
            <button class="level-btn" data-level="minor" aria-pressed="false">Minor Scales</button>
            <button class="level-btn" data-level="modes" aria-pressed="false">Modes</button>
            <button class="level-btn" data-level="harmMajor" aria-pressed="false">Harm. Major</button>
            <button class="level-btn" data-level="harmMinor" aria-pressed="false">Harm. Minor</button>
            <button class="level-btn" data-level="freeplay" aria-pressed="false">Free Play</button>
          </div>
        </div>

        <!-- â”€ SECTION: PLAYBACK â”€ -->
        <div class="ctrl-section">
          <div class="ctrl-section-header">
            <span class="ctrl-section-icon">â–¶</span>
            <span>Playback</span>
          </div>

          <!-- Octave -->
          <div class="octave-row" role="group" aria-label="Octave selector">
            <button class="octave-btn" id="octaveDown" type="button" aria-label="Lower octave">â—€</button>
            <div class="octave-display" aria-live="polite">
              <small>Octave</small>
              <div id="octaveLabel">Octave 4 (Middle C)</div>
            </div>
            <button class="octave-btn" id="octaveUp" type="button" aria-label="Higher octave">â–¶</button>
          </div>

          <!-- Tempo -->
          <div class="tempo-control">
            <label for="tempoSlider">â± Tempo</label>
            <div class="tempo-slider-row">
              <span class="tempo-label">40</span>
              <input type="range" id="tempoSlider" min="40" max="240" value="120" step="10"
                aria-label="Tempo in BPM" aria-valuemin="40" aria-valuemax="240" aria-valuenow="120">
              <span class="tempo-label">240</span>
            </div>
            <div class="bpm-display"><span id="bpmDisplay">120</span> BPM</div>
          </div>

          <!-- Play Buttons 2x2 grid -->
          <div class="play-grid" role="group" aria-label="Playback controls">
            <button class="play-btn" id="playUpBtn" type="button">â†‘ Ascending</button>
            <button class="play-btn" id="playDownBtn" type="button">â†“ Descending</button>
            <button class="play-btn" id="playScaleBtn" type="button">â™« Full Scale</button>
            <button class="play-btn" id="playChordBtn" type="button">â™ª Chord</button>
          </div>
        </div>

        <!-- â”€ SECTION: CHORD SETTINGS (dynamic) â”€ -->
        <div class="ctrl-section" id="dynamicControls">
          <div class="ctrl-section-header">
            <span class="ctrl-section-icon">âš™ï¸</span>
            <span>Settings</span>
          </div>
          <div id="controls"></div>
        </div>

        <!-- â”€ SECTION: PROGRESSIONS â”€ -->
        <div class="ctrl-section" id="progressionControls" style="display:none">
          <div class="ctrl-section-header">
            <span class="ctrl-section-icon">ğŸ¼</span>
            <span>Progressions â€” Key of <span id="progressionKey">C</span></span>
          </div>
          <div class="progression-meta">
            <span id="progressionChordType">Triads</span> Â· <span id="progressionScaleType">Major</span>
          </div>
          <button class="play-btn play-btn-blue" id="playAllChordsBtn" type="button" style="width:100%;margin-bottom:10px;">
            ğŸ¹ Play All Scale Chords
          </button>
          <div class="progression-buttons" id="progressionButtons" role="list"></div>
        </div>

        <!-- â”€ SECTION: RECORDING â”€ -->
        <div class="ctrl-section">
          <div class="ctrl-section-header">
            <span class="ctrl-section-icon">ğŸ™</span>
            <span>Recording Studio</span>
          </div>
          <div class="rec-grid" role="group" aria-label="Recording controls">
            <button class="rec-btn" id="recordBtn" type="button" aria-label="Toggle recording" aria-pressed="false">
              <span>âº</span> Record
            </button>
            <button class="rec-btn rec-green" id="playRecBtn" type="button">
              <span>â–¶</span> Play
            </button>
            <button class="rec-btn rec-orange" id="clearRecBtn" type="button">
              <span>ğŸ—‘</span> Clear
            </button>
            <button class="rec-btn rec-purple" id="downloadRecBtn" type="button">
              <span>ğŸ’¾</span> Save
            </button>
          </div>
          <div id="recordingStatus" aria-live="polite" role="status" class="rec-status"></div>
        </div>

        <!-- â”€ SECTION: KEYBOARD SHORTCUTS â”€ -->
        <div class="ctrl-section ctrl-section-compact">
          <div class="ctrl-section-header">
            <span class="ctrl-section-icon">âŒ¨</span>
            <span>Shortcuts</span>
          </div>
          <div class="shortcuts-grid">
            <div class="shortcut-item"><kbd>Space</kbd><span>Play Chord</span></div>
            <div class="shortcut-item"><kbd>â†‘â†“</kbd><span>Octave</span></div>
            <div class="shortcut-item"><kbd>â†â†’</kbd><span>Root Note</span></div>
            <div class="shortcut-item"><kbd>1â€“9</kbd><span>Mode</span></div>
            <div class="shortcut-item"><kbd>R</kbd><span>Record</span></div>
            <div class="shortcut-item"><kbd>P</kbd><span>Playback</span></div>
          </div>
        </div>

      </div><!-- /controls-col -->

    </main><!-- /app-layout -->

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         FOOTER â€” ALL LINKS FROM SITE STRUCTURE
         Files visible: about.html, contact.html, privacy.html,
         refund-policy.html, terms.html, sitemap.xml, robots.txt
         pricing.html, offerings.html, my-apps.html, signup.html
         cookie-consent-banner.html, cookie-policy.html
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <footer class="site-footer" role="contentinfo" aria-label="Site footer">

      <!-- MAIN FOOTER GRID -->
      <div class="footer-grid">

        <!-- BRAND COLUMN -->
        <div class="footer-brand">
          <div class="footer-logo" aria-label="Keys, Codes and Modes">
            ğŸµ Keys, Codes &amp; Modes
          </div>
          <p class="footer-brand-desc">
            Visual music education by <strong style="-webkit-text-fill-color:var(--text-primary);color:var(--text-primary);">Ben Ryan</strong> â€”
            inventor of the FreeStyleÂ® Musical Device. Making music theory
            beautiful, intuitive &amp; accessible to everyone.
          </p>
          <p style="font-size:11px;color:var(--text-secondary);margin:0 0 12px;">
            ğŸ“ Santa Barbara, California &nbsp;|&nbsp;
            <a href="https://keyscodesandmodes.com/contact.html" style="color:var(--accent-teal);text-decoration:none;">Contact Us</a>
          </p>
          <!-- Compliance Badges -->
          <div class="footer-compliance-badges" aria-label="Compliance certifications">
            <span class="compliance-badge badge-green" title="Web Content Accessibility Guidelines 2.1 Level AA">â™¿ WCAG 2.1 AA</span>
            <span class="compliance-badge badge-blue" title="General Data Protection Regulation compliant">ğŸ”’ GDPR</span>
            <span class="compliance-badge badge-blue" title="California Consumer Privacy Act compliant">ğŸ›¡ CCPA</span>
            <span class="compliance-badge badge-gold" title="Americans with Disabilities Act compliant">âš–ï¸ ADA</span>
            <span class="compliance-badge badge-teal" title="Section 508 of the Rehabilitation Act">Â§508</span>
            <span class="compliance-badge" title="SSL/TLS encrypted connection">ğŸ” SSL</span>
          </div>
        </div>

        <!-- EXPLORE COLUMN -->
        <div class="footer-col">
          <h3 class="footer-col-title">Explore</h3>
          <ul class="footer-nav-list">
            <li><a href="https://keyscodesandmodes.com/index.html">
              <span class="fnav-icon" aria-hidden="true">ğŸ </span>Home</a></li>
            <li><a href="https://keyscodesandmodes.com/about.html">
              <span class="fnav-icon" aria-hidden="true">ğŸ‘¤</span>About Ben Ryan</a></li>
            <li><a href="https://keyscodesandmodes.com/my-apps.html">
              <span class="fnav-icon" aria-hidden="true">ğŸ“±</span>All Apps</a></li>
            <li><a href="https://keyscodesandmodes.com/my-apps-premium.html">
              <span class="fnav-icon" aria-hidden="true">â­</span>Premium Apps</a></li>
            <li><a href="https://keyscodesandmodes.com/offerings.html">
              <span class="fnav-icon" aria-hidden="true">ğŸ</span>Offerings</a></li>
            <li><a href="https://keyscodesandmodes.com/pricing.html">
              <span class="fnav-icon" aria-hidden="true">ğŸ’°</span>Pricing</a></li>
            <li><a href="https://keyscodesandmodes.com/insights.html">
              <span class="fnav-icon" aria-hidden="true">ğŸ’¡</span>Insights</a></li>
            <li><a href="https://keyscodesandmodes.com/contact.html">
              <span class="fnav-icon" aria-hidden="true">âœ‰ï¸</span>Contact</a></li>
          </ul>
        </div>

        <!-- LEGAL & PRIVACY COLUMN -->
        <div class="footer-col">
          <h3 class="footer-col-title">Legal &amp; Privacy</h3>
          <ul class="footer-nav-list">
            <li><a href="https://keyscodesandmodes.com/privacy.html">
              <span class="fnav-icon" aria-hidden="true">ğŸ”’</span>Privacy Policy</a></li>
            <li><a href="https://keyscodesandmodes.com/terms.html">
              <span class="fnav-icon" aria-hidden="true">ğŸ“„</span>Terms of Service</a></li>
            <li><a href="https://keyscodesandmodes.com/refund-policy.html">
              <span class="fnav-icon" aria-hidden="true">â†©ï¸</span>Refund Policy</a></li>
            <li><a href="https://keyscodesandmodes.com/cookie-policy.html">
              <span class="fnav-icon" aria-hidden="true">ğŸª</span>Cookie Policy</a></li>
            <li><a href="https://keyscodesandmodes.com/cookie-consent-banner.html">
              <span class="fnav-icon" aria-hidden="true">âš™ï¸</span>Cookie Preferences</a></li>
            <li><a href="https://keyscodesandmodes.com/access-code-entry.html">
              <span class="fnav-icon" aria-hidden="true">ğŸ”‘</span>Access Code Entry</a></li>
            <li><a href="https://keyscodesandmodes.com/sitemap.xml" type="application/xml" aria-label="XML Sitemap">
              <span class="fnav-icon" aria-hidden="true">ğŸ—º</span>Sitemap (XML)</a></li>
            <li><a href="https://keyscodesandmodes.com/robots.txt" type="text/plain" aria-label="Robots.txt file">
              <span class="fnav-icon" aria-hidden="true">ğŸ¤–</span>robots.txt</a></li>
          </ul>
        </div>

        <!-- ACCOUNT & SUPPORT COLUMN -->
        <div class="footer-col">
          <h3 class="footer-col-title">Account &amp; Support</h3>
          <ul class="footer-nav-list">
            <li><a href="https://keyscodesandmodes.com/signup.html">
              <span class="fnav-icon" aria-hidden="true">ğŸ†•</span>Sign Up</a></li>
            <li><a href="https://keyscodesandmodes.com/auth/">
              <span class="fnav-icon" aria-hidden="true">ğŸ”</span>Login / Auth</a></li>
            <li><a href="https://keyscodesandmodes.com/welcome-free.html">
              <span class="fnav-icon" aria-hidden="true">ğŸ‘‹</span>Free Member Welcome</a></li>
            <li><a href="https://keyscodesandmodes.com/welcome-premium.html">
              <span class="fnav-icon" aria-hidden="true">ğŸŒŸ</span>Premium Welcome</a></li>
            <li><a href="https://keyscodesandmodes.com/welcome-founder.html">
              <span class="fnav-icon" aria-hidden="true">ğŸ†</span>Founder Welcome</a></li>
            <li><a href="https://keyscodesandmodes.com/IMPLEMENTATION_GUIDE.md" aria-label="Implementation Guide document">
              <span class="fnav-icon" aria-hidden="true">ğŸ“‹</span>Implementation Guide</a></li>
            <li><a href="https://keyscodesandmodes.com/contact.html" aria-label="Get support">
              <span class="fnav-icon" aria-hidden="true">ğŸ†˜</span>Get Help</a></li>
          </ul>
        </div>

      </div><!-- /footer-grid -->

      <!-- BOTTOM BAR -->
      <div class="footer-bottom">
        <div class="footer-bottom-left">
          <strong>&copy; <span id="currentYear"></span> Ben Ryan â€” Keys, Codes &amp; Modes.</strong>
          All rights reserved. &nbsp;Â·&nbsp;
          FreeStyleÂ® is a registered trademark of Ben Ryan. &nbsp;Â·&nbsp;
          Santa Barbara, CA, USA
        </div>
        <div class="footer-bottom-right">
          <nav class="footer-legal-links" aria-label="Quick legal links">
            <a href="https://keyscodesandmodes.com/privacy.html">Privacy</a>
            <a href="https://keyscodesandmodes.com/terms.html">Terms</a>
            <a href="https://keyscodesandmodes.com/refund-policy.html">Refunds</a>
            <a href="https://keyscodesandmodes.com/cookie-policy.html">Cookies</a>
          </nav>
          <a href="https://keyscodesandmodes.com/about.html#accessibility"
            class="footer-accessibility-link"
            aria-label="Accessibility statement â€” WCAG 2.1 AA compliant">
            â™¿ Accessibility
          </a>
        </div>
      </div>

      <!-- ACCESSIBILITY STATEMENT BAR -->
      <div class="footer-a11y-bar" role="note" aria-label="Accessibility and compliance statement">
        This application complies with
        <a href="https://www.w3.org/WAI/WCAG21/quickref/" rel="noopener noreferrer" target="_blank" aria-label="WCAG 2.1 guidelines (opens new tab)">WCAG 2.1 AA</a>,
        <a href="https://keyscodesandmodes.com/privacy.html#gdpr" aria-label="GDPR compliance details">GDPR</a>,
        <a href="https://keyscodesandmodes.com/privacy.html#ccpa" aria-label="CCPA compliance details">CCPA</a>,
        ADA Title III, and Section 508 accessibility requirements.
        Google Analytics is only activated with your explicit consent.
        Cookie preferences can be changed at any time via
        <a href="https://keyscodesandmodes.com/cookie-consent-banner.html">Cookie Settings</a>.
        Need assistance? <a href="https://keyscodesandmodes.com/contact.html">Contact us</a>.
      </div>

    </footer>

  </div><!-- /page-wrapper -->

  <!-- INTERVAL POPUP -->
  <div id="intervalPopup" role="dialog" aria-modal="true" aria-labelledby="intervalPopupTitle" aria-describedby="intervalPopupDesc"></div>

  <script>
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MUSIC THEORY EXPLORER PRO â€” MAIN SCRIPT
     Optimized: Consent-first analytics, ARIA,
     responsive, accessible, cross-browser
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  'use strict';

  // â”€â”€ YEAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('currentYear').textContent = new Date().getFullYear();

  // â”€â”€ COOKIE CONSENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  (function() {
    const banner = document.getElementById('cookie-banner');
    const key = 'mtep_analytics_consent';
    const stored = localStorage.getItem(key);

    if (!stored) {
      setTimeout(() => banner.classList.add('show'), 800);
    } else if (stored === 'granted') {
      loadAnalytics();
    }

    document.getElementById('cookieAccept').addEventListener('click', () => {
      localStorage.setItem(key, 'granted');
      banner.classList.remove('show');
      loadAnalytics();
    });
    document.getElementById('cookieDecline').addEventListener('click', () => {
      localStorage.setItem(key, 'denied');
      banner.classList.remove('show');
    });
  })();

  // â”€â”€ GLOBAL ERROR HANDLER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  window.onerror = (msg, url, line, col, err) => {
    console.error('Global error:', { msg, url, line, col, err });
    return true;
  };
  window.addEventListener('unhandledrejection', e => {
    console.error('Unhandled promise rejection:', e.reason);
    e.preventDefault();
  });

  (function() {
    // â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let audioContext, audioReady = false;
    let currentLevel = '1', currentView = 'circle', rootNote = 0;
    let selectedNotes = new Set([0]), multiSelectNotes = new Set(), currentOctave = 4;
    let currentWaveform = 'sine', currentBPM = 120, currentModeSelection = 'ionian';
    let currentTriadSelection = 'major', currentExtendedSelection = 'major7';
    let currentMinorType = 'naturalMinor', currentHarmDegree = 0, currentHarmChordType = 'triad';
    let quizCorrect = 0, quizTotal = 0, currentQuiz = null;
    let isRecording = false, recordedNotes = [], recordingStartTime = 0;
    let guitarFretCount = 5;

    // â”€â”€ MUSICAL DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const noteNames = ['C','C#/Db','D','D#/Eb','E','F','F#/Gb','G','G#/Ab','A','A#/Bb','B'];
    const noteNamesShort = ['C','C#','D','D#','E','F','F#','G','G#','A','A#','B'];
    const enharmonicNames = ['C','C#\nDb','D','D#\nEb','E','F','F#\nGb','G','G#\nAb','A','A#\nBb','B'];
    const colors = ['#FFFF00','#FFC400','#FF8000','#FF4000','#FF0000','#C4007F','#8000FF','#4000FF','#0000FF','#007FFF','#00FF80','#80FF00'];
    const textColors = ['#000','#000','#000','#fff','#fff','#fff','#fff','#fff','#fff','#fff','#000','#000'];

    const triads = { major:[0,4,7], minor:[0,3,7], diminished:[0,3,6], augmented:[0,4,8] };
    const extended = {
      major7:[0,4,7,11], dominant7:[0,4,7,10], minor7:[0,3,7,10],
      diminished7:[0,3,6,9], augmented7:[0,4,8,10], halfDiminished7:[0,3,6,10],
      minorMajor7:[0,3,7,11], augmentedMajor7:[0,4,8,11]
    };
    const scales = {
      majorPentatonic:[0,2,4,7,9], minorPentatonic:[0,3,5,7,10],
      major:[0,2,4,5,7,9,11], naturalMinor:[0,2,3,5,7,8,10],
      harmonicMinor:[0,2,3,5,7,8,11], melodicMinor:[0,2,3,5,7,9,11]
    };
    const modes = {
      ionian:[0,2,4,5,7,9,11], dorian:[0,2,3,5,7,9,10],
      phrygian:[0,1,3,5,7,8,10], lydian:[0,2,4,6,7,9,11],
      mixolydian:[0,2,4,5,7,9,10], aeolian:[0,2,3,5,7,8,10],
      locrian:[0,1,3,5,6,8,10]
    };

    const harmonizedMajorTriads = [
      {name:'I',quality:'Major',intervals:[0,4,7]}, {name:'ii',quality:'minor',intervals:[2,5,9]},
      {name:'iii',quality:'minor',intervals:[4,7,11]}, {name:'IV',quality:'Major',intervals:[5,9,12]},
      {name:'V',quality:'Major',intervals:[7,11,14]}, {name:'vi',quality:'minor',intervals:[9,12,16]},
      {name:'viiÂ°',quality:'dim',intervals:[11,14,17]}
    ];
    const harmonizedMajor7ths = [
      {name:'Imaj7',quality:'Maj7',intervals:[0,4,7,11]}, {name:'ii7',quality:'m7',intervals:[2,5,9,12]},
      {name:'iii7',quality:'m7',intervals:[4,7,11,14]}, {name:'IVmaj7',quality:'Maj7',intervals:[5,9,12,16]},
      {name:'V7',quality:'Dom7',intervals:[7,11,14,17]}, {name:'vi7',quality:'m7',intervals:[9,12,16,19]},
      {name:'viiÃ¸7',quality:'m7â™­5',intervals:[11,14,17,21]}
    ];
    const harmonizedMinorTriads = [
      {name:'i',quality:'minor',intervals:[0,3,7]}, {name:'iiÂ°',quality:'dim',intervals:[2,5,8]},
      {name:'III',quality:'Major',intervals:[3,7,10]}, {name:'iv',quality:'minor',intervals:[5,8,12]},
      {name:'v',quality:'minor',intervals:[7,10,14]}, {name:'VI',quality:'Major',intervals:[8,12,15]},
      {name:'VII',quality:'Major',intervals:[10,14,17]}
    ];
    const harmonizedMinor7ths = [
      {name:'im7',quality:'m7',intervals:[0,3,7,10]}, {name:'iiÃ¸7',quality:'m7â™­5',intervals:[2,5,8,12]},
      {name:'IIImaj7',quality:'Maj7',intervals:[3,7,10,14]}, {name:'ivm7',quality:'m7',intervals:[5,8,12,15]},
      {name:'vm7',quality:'m7',intervals:[7,10,14,17]}, {name:'VImaj7',quality:'Maj7',intervals:[8,12,15,19]},
      {name:'VII7',quality:'Dom7',intervals:[10,14,17,20]}
    ];
    const intervalNames = {
      0:'Unison (P1)',1:'Minor 2nd (m2)',2:'Major 2nd (M2)',3:'Minor 3rd (m3)',
      4:'Major 3rd (M3)',5:'Perfect 4th (P4)',6:'Tritone (TT)',7:'Perfect 5th (P5)',
      8:'Minor 6th (m6)',9:'Major 6th (M6)',10:'Minor 7th (m7)',11:'Major 7th (M7)'
    };
    const intervalDescriptions = {
      0:'Same note â€” no interval',1:'Half step â€” very dissonant, creates tension',
      2:'Whole step â€” common in melodies',3:'Sad, melancholic â€” minor chord base',
      4:'Happy, bright â€” major chord base',5:'Very consonant â€” strong, stable',
      6:'Most dissonant â€” divides octave in half',7:'Most consonant after octave â€” power chord',
      8:'Somewhat dissonant â€” inverted major 3rd',9:'Smooth, pleasant â€” common in melodies',
      10:'Bluesy, jazzy â€” dominant 7th',11:'Dissonant, leading â€” major 7th chord'
    };
    const keySignatures = {
      0:{sharps:0,flats:0,name:'C major'}, 1:{sharps:0,flats:5,name:'Db major'},
      2:{sharps:2,flats:0,name:'D major'}, 3:{sharps:0,flats:3,name:'Eb major'},
      4:{sharps:4,flats:0,name:'E major'}, 5:{sharps:0,flats:1,name:'F major'},
      6:{sharps:6,flats:0,name:'F# major'}, 7:{sharps:1,flats:0,name:'G major'},
      8:{sharps:0,flats:4,name:'Ab major'}, 9:{sharps:3,flats:0,name:'A major'},
      10:{sharps:0,flats:2,name:'Bb major'}, 11:{sharps:5,flats:0,name:'B major'}
    };

    window.playSelection = playSelection;
    window.playNote = playNote;

    // â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function init() {
      window.currentPatternIntervals = [];
      createSpheres();
      createPiano();
      createGuitar();
      updateDisplay();
      updateView();
      updateOctaveDisplay();
      setupEventListeners();
      setupKeyboardShortcuts();
      initMIDI();
      setTimeout(() => updateStaffNotation(Array.from(selectedNotes)), 100);
    }

    // â”€â”€ EVENT LISTENERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function setupEventListeners() {
      document.getElementById('startAudio').onclick = initAudio;

      // View tabs
      document.querySelectorAll('.view-btn').forEach(btn => {
        btn.onclick = function() {
          document.querySelectorAll('.view-btn').forEach(b => {
            b.classList.remove('active');
            b.setAttribute('aria-selected', 'false');
          });
          this.classList.add('active');
          this.setAttribute('aria-selected', 'true');
          currentView = this.dataset.view;
          updateView();
        };
      });

      // Level buttons
      document.querySelectorAll('.level-btn[data-level]').forEach(btn => {
        btn.onclick = function() {
          document.querySelectorAll('.level-btn[data-level]').forEach(b => {
            b.classList.remove('active');
            b.setAttribute('aria-pressed', 'false');
          });
          this.classList.add('active');
          this.setAttribute('aria-pressed', 'true');
          currentLevel = this.dataset.level;

          const hint = document.getElementById('freeplayHint');
          if (hint) hint.style.display = currentLevel === 'freeplay' ? 'block' : 'none';

          const pc = document.getElementById('progressionControls');
          if ((currentLevel === 'harmMajor' || currentLevel === 'harmMinor') && currentView !== 'ear') {
            pc.style.display = 'block';
            updateProgressionButtons();
            const pKey = document.getElementById('progressionKey');
            const pType = document.getElementById('progressionChordType');
            const pScale = document.getElementById('progressionScaleType');
            if (pKey) pKey.textContent = noteNames[rootNote];
            if (pType) pType.textContent = currentHarmChordType === '7th' ? 'Seventh Chords (4-note)' : 'Triads (3-note)';
            if (pScale) pScale.textContent = currentLevel === 'harmMinor' ? 'Natural Minor' : 'Major';
          } else {
            pc.style.display = 'none';
          }

          if (currentLevel === 'freeplay') {
            multiSelectNotes.clear();
            selectedNotes = new Set();
            window.currentPatternIntervals = [];
          } else if (currentLevel === '2') {
            selectedNotes = new Set([0, 7]);
            window.currentPatternIntervals = [0, 7];
          } else if (currentLevel === 'harmMajor' || currentLevel === 'harmMinor') {
            currentHarmDegree = 0;
            currentHarmChordType = 'triad';
          }
          updateDisplay();
          updateView();
        };
      });

      document.getElementById('playUpBtn').onclick = () => playSelection('up');
      document.getElementById('playDownBtn').onclick = () => playSelection('down');
      document.getElementById('playScaleBtn').onclick = () => playSelection('scale');
      document.getElementById('playChordBtn').onclick = () => playSelection('chord');

      document.getElementById('octaveDown').onclick = () => {
        if (currentOctave > 0) { currentOctave--; updateOctaveDisplay(); }
      };
      document.getElementById('octaveUp').onclick = () => {
        if (currentOctave < 8) { currentOctave++; updateOctaveDisplay(); }
      };

      document.getElementById('playQuizBtn').onclick = playQuizSound;
      document.getElementById('newQuizBtn').onclick = generateQuiz;
      document.getElementById('recordBtn').onclick = startRecording;
      document.getElementById('playRecBtn').onclick = playbackRecording;
      document.getElementById('clearRecBtn').onclick = () => {
        recordedNotes = [];
        const st = document.getElementById('recordingStatus');
        if (st) st.textContent = 'ğŸ—‘ Recording cleared';
      };
      document.getElementById('downloadRecBtn').onclick = downloadMIDI;

      const slider = document.getElementById('tempoSlider');
      const bpmDisp = document.getElementById('bpmDisplay');
      slider.oninput = function() {
        currentBPM = parseInt(this.value);
        bpmDisp.textContent = currentBPM;
        this.setAttribute('aria-valuenow', currentBPM);
        slider.setAttribute('aria-valuetext', currentBPM + ' BPM');
      };

      const fret3 = document.getElementById('fret3Btn');
      const fret5 = document.getElementById('fret5Btn');
      const fret12 = document.getElementById('fret12Btn');
      const allFretBtns = [fret3, fret5, fret12];
      function setFretCount(n, activeBtn) {
        guitarFretCount = n;
        allFretBtns.forEach(b => { if(b){b.classList.remove('active'); b.setAttribute('aria-pressed','false');} });
        activeBtn.classList.add('active'); activeBtn.setAttribute('aria-pressed','true');
        createGuitar();
        setTimeout(() => { updateSphereDisplay(); updateStringLabels(); }, 50);
      }
      if (fret3)  fret3.onclick  = () => setFretCount(3,  fret3);
      if (fret5)  fret5.onclick  = () => setFretCount(5,  fret5);
      if (fret12) fret12.onclick = () => setFretCount(12, fret12);

      setTimeout(() => {
        const btn = document.getElementById('playAllChordsBtn');
        if (btn) btn.onclick = playAllScaleChords;
      }, 100);
    }

    function setupKeyboardShortcuts() {
      document.addEventListener('keydown', e => {
        if (!audioReady) return;
        const tag = (e.target.tagName || '').toLowerCase();
        if (tag === 'input' || tag === 'select' || tag === 'textarea') return;

        switch(e.key) {
          case ' ': e.preventDefault(); playSelection('chord'); break;
          case 'ArrowUp': e.preventDefault(); if (currentOctave < 8) { currentOctave++; updateOctaveDisplay(); } break;
          case 'ArrowDown': e.preventDefault(); if (currentOctave > 0) { currentOctave--; updateOctaveDisplay(); } break;
          case 'ArrowLeft': e.preventDefault(); rootNote = (rootNote - 1 + 12) % 12; updateDisplay(); break;
          case 'ArrowRight': e.preventDefault(); rootNote = (rootNote + 1) % 12; updateDisplay(); break;
          case 'r': case 'R': startRecording(); break;
          case 'p': case 'P': playbackRecording(); break;
        }
        if (e.key >= '1' && e.key <= '9') {
          const lvls = ['1','2','3','4','5','7','minor','modes','harmMajor'];
          const idx = parseInt(e.key) - 1;
          if (idx < lvls.length) {
            const btn = document.querySelector(`.level-btn[data-level="${lvls[idx]}"]`);
            if (btn) btn.click();
          }
        }
      });
    }

    // â”€â”€ AUDIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function initAudio() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      audioContext.resume().then(() => {
        audioReady = true;
        const btn = document.getElementById('startAudio');
        btn.textContent = 'âœ“ Audio Ready';
        btn.disabled = true;
        btn.setAttribute('aria-label', 'Audio engine is ready');
        document.getElementById('status').textContent = 'âœ¨ Ready! Click notes or use controls below.';
        setTimeout(() => playNote(0, 4, 0.3), 100);
        // Track event if analytics granted
        if (window.gtag) gtag('event', 'audio_start', { event_category: 'engagement' });
      }).catch(err => {
        console.error('Audio context error:', err);
        alert('Audio initialization failed. Please try again.');
      });
    }

    function initMIDI() {
      if (!navigator.requestMIDIAccess) return;
      navigator.requestMIDIAccess().then(access => {
        for (let input of access.inputs.values()) {
          input.onmidimessage = e => {
            const [status, note, vel] = e.data;
            const cmd = status >> 4;
            if (cmd === 9 && vel > 0) {
              const n = note % 12, oct = Math.floor(note / 12) - 1;
              playNote(n, oct, 0.5);
              highlightNote(n, true);
            } else if (cmd === 8 || (cmd === 9 && vel === 0)) {
              highlightNote(note % 12, false);
            }
          };
        }
      }).catch(() => {});
    }

    // â”€â”€ BUILD UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function createSpheres() {
      const circle = document.getElementById('chromaticCircle');
      if (!circle) return;
      const enharmonicLabels = ['C','Câ™¯\nDâ™­','D','Dâ™¯\nEâ™­','E','F','Fâ™¯\nGâ™­','G','Gâ™¯\nAâ™­','A','Aâ™¯\nBâ™­','B'];
      const r = circle.offsetWidth / 2 || 240;
      const radius = r * 0.77;
      for (let i = 0; i < 12; i++) {
        const angle = (i * 30 - 90) * (Math.PI / 180);
        const x = r + radius * Math.cos(angle);
        const y = r + radius * Math.sin(angle);
        const s = document.createElement('div');
        s.className = 'sphere';
        const sz = Math.max(54, Math.min(68, r * 0.145));
        s.style.cssText = `left:${x - sz/2}px;top:${y - sz/2}px;width:${sz}px;height:${sz}px;background:${colors[i]};color:${textColors[i]};font-size:${enharmonicLabels[i].includes('\n')?'11px':'14px'};`;
        s.style.whiteSpace = 'pre-line';
        s.textContent = enharmonicLabels[i];
        s.dataset.note = i;
        s.setAttribute('role', 'button');
        s.setAttribute('aria-label', `Note ${noteNames[i]} â€” click to select`);
        s.setAttribute('tabindex', '0');
        s.onclick = () => handleNoteClick(i);
        s.onkeydown = e => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); handleNoteClick(i); } };
        circle.appendChild(s);
      }
    }

    function createPiano() {
      const container = document.getElementById('pianoContainer');
      if (!container) return;
      container.innerHTML = '';
      const whiteNotes = [0,2,4,5,7,9,11];
      const blackNotes = [{note:1,after:0},{note:3,after:2},{note:6,after:5},{note:8,after:7},{note:10,after:9}];
      const wkw = Math.max(36, Math.min(52, window.innerWidth / 9));

      whiteNotes.forEach((n, idx) => {
        const k = document.createElement('div');
        k.className = 'white-key';
        k.style.width = wkw + 'px';
        k.dataset.note = n;
        k.setAttribute('role', 'button');
        k.setAttribute('aria-label', `${noteNames[n]} â€” click to play`);
        k.setAttribute('tabindex', '0');
        k.onclick = () => handleNoteClick(n);
        k.onkeydown = e => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); handleNoteClick(n); } };
        const l = document.createElement('div');
        l.className = 'key-label';
        l.textContent = noteNamesShort[n];
        l.setAttribute('aria-hidden', 'true');
        k.appendChild(l);
        container.appendChild(k);
      });

      blackNotes.forEach(({note, after}) => {
        const k = document.createElement('div');
        k.className = 'black-key';
        k.style.width = Math.round(wkw * 0.62) + 'px';
        k.dataset.note = note;
        const afterIdx = whiteNotes.indexOf(after);
        k.style.left = ((afterIdx * wkw) + wkw - Math.round(wkw * 0.31)) + 'px';
        k.setAttribute('role', 'button');
        k.setAttribute('aria-label', `${noteNames[note]} â€” click to play`);
        k.setAttribute('tabindex', '0');
        k.onclick = () => handleNoteClick(note);
        k.onkeydown = e => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); handleNoteClick(note); } };
        const l = document.createElement('div');
        l.className = 'key-label';
        l.textContent = enharmonicNames[note];
        l.setAttribute('aria-hidden', 'true');
        k.appendChild(l);
        container.appendChild(k);
      });
    }

    function createGuitar() {
      const fb = document.getElementById('fretboard');
      if (!fb) return;
      fb.innerHTML = '';
      const tuning = [4,9,2,7,11,4];
      const names = ['E','A','D','G','B','E'];
      const octs = [3,3,4,4,4,5];
      const fretH = guitarFretCount === 12 ? 50 : guitarFretCount === 3 ? 120 : 80;
      const totalH = guitarFretCount * fretH;
      fb.style.height = totalH + 'px';
      fb.style.width = '180px';

      for (let s = 0; s < 6; s++) {
        const str = document.createElement('div');
        str.className = 'guitar-string';
        str.style.cssText = `left:${30*s+15}px;width:${s>=4?1:s>=2?2:3}px;height:100%;background:linear-gradient(to bottom,#C0C0C0 0%,#808080 100%);top:0;`;
        fb.appendChild(str);

        const lbl = document.createElement('div');
        lbl.className = 'string-label';
        lbl.textContent = names[s];
        lbl.style.left = (30 * s - 5) + 'px';
        lbl.dataset.note = tuning[s];
        lbl.setAttribute('role', 'button');
        lbl.setAttribute('aria-label', `Open string ${names[s]} â€” click to play`);
        lbl.setAttribute('tabindex', '0');
        lbl.onclick = () => playNote(tuning[s], octs[s], 0.8);
        lbl.onkeydown = e => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); playNote(tuning[s], octs[s], 0.8); } };
        fb.appendChild(lbl);
      }

      for (let f = 1; f <= guitarFretCount; f++) {
        const fw = document.createElement('div');
        fw.className = 'fret-wire';
        fw.style.top = (f * fretH) + 'px';
        fw.setAttribute('aria-hidden', 'true');
        fb.appendChild(fw);
      }

      const markerFrets = guitarFretCount === 12 ? [3,5,7,9,12] : guitarFretCount === 3 ? [3] : [3,5];
      markerFrets.forEach(fret => {
        if (fret > guitarFretCount) return;
        const positions = fret === 12 ? [1.5,4.5] : [3];
        positions.forEach(p => {
          const m = document.createElement('div');
          m.style.cssText = `position:absolute;width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,0.25);left:${30*p}px;top:${fret*fretH-fretH/2}px;transform:translate(-5px,-5px);pointer-events:none;`;
          m.setAttribute('aria-hidden', 'true');
          fb.appendChild(m);
        });
      });

      for (let s = 0; s < 6; s++) {
        for (let f = 1; f <= guitarFretCount; f++) {
          const n = (tuning[s] + f) % 12;
          const dot = document.createElement('div');
          dot.className = 'note-dot';
          dot.style.cssText = `left:${30*s+15}px;top:${f*fretH-fretH/2}px;background:${colors[n]};color:${textColors[n]};`;
          dot.textContent = noteNamesShort[n];
          dot.setAttribute('role', 'button');
          dot.setAttribute('aria-label', `${noteNames[n]} fret ${f} string ${s+1}`);
          dot.setAttribute('tabindex', '0');
          const oct = octs[s] + Math.floor((tuning[s] + f) / 12);
          dot.onclick = () => playNote(n, oct, 0.8);
          dot.onkeydown = e => { if (e.key==='Enter'||e.key===' ') { e.preventDefault(); playNote(n,oct,0.8); } };
          fb.appendChild(dot);
        }
      }
      updateStringLabels();
    }

    // â”€â”€ NOTE INTERACTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function handleNoteClick(noteIndex) {
      if (!audioReady) {
        alert('Please click Start Audio Engine first!');
        return;
      }
      if (currentLevel === 'freeplay') {
        if (multiSelectNotes.has(noteIndex)) multiSelectNotes.delete(noteIndex);
        else multiSelectNotes.add(noteIndex);
        selectedNotes = new Set(multiSelectNotes);
        window.currentPatternIntervals = [];
        playNote(noteIndex);
        updateDisplay();
      } else if (currentLevel === '2') {
        if (selectedNotes.size === 0 || selectedNotes.size === 2) {
          rootNote = noteIndex;
          selectedNotes = new Set([noteIndex]);
          window.currentPatternIntervals = [0];
          playNote(noteIndex);
          updateDisplay();
        } else if (selectedNotes.size === 1) {
          selectedNotes.add(noteIndex);
          const notes = Array.from(selectedNotes).sort((a, b) => a - b);
          const interval = (notes[1] - notes[0] + 12) % 12;
          window.currentPatternIntervals = [0, interval];
          updateDisplay();
          playNote(notes[0], currentOctave, 0.8);
          setTimeout(() => {
            playNote(notes[1], currentOctave, 0.8);
            setTimeout(() => showIntervalInfo(interval), 500);
          }, 600);
        }
      } else {
        rootNote = noteIndex;
        playNote(noteIndex);
        updateDisplay();
      }
    }

    // â”€â”€ AUDIO PLAYBACK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const FREQS = [261.63,277.18,293.66,311.13,329.63,349.23,369.99,392.00,415.30,440.00,466.16,493.88];

    function playNote(n, oct = currentOctave, dur = 0.8) {
      if (!audioContext || !audioReady) return;
      const freq = FREQS[n] * Math.pow(2, oct - 4);
      if (isRecording) {
        recordedNotes.push({ note:n, octave:oct, timestamp: Date.now() - recordingStartTime, duration:dur });
      }
      const osc = audioContext.createOscillator();
      const gain = audioContext.createGain();
      osc.connect(gain);
      gain.connect(audioContext.destination);
      osc.frequency.value = freq;
      osc.type = currentWaveform;
      const now = audioContext.currentTime;
      gain.gain.setValueAtTime(0, now);
      gain.gain.linearRampToValueAtTime(0.3, now + 0.01);
      gain.gain.exponentialRampToValueAtTime(0.01, now + dur);
      osc.start(now);
      osc.stop(now + dur);
      highlightNote(n, true);
      updateStaffNotation([n]);
      setTimeout(() => { highlightNote(n, false); updateStaffNotation(Array.from(selectedNotes)); }, dur * 1000);
    }

    function highlightNote(n, on) {
      const sphere = document.querySelector(`.sphere[data-note="${n}"]`);
      const wKey = document.querySelector(`.white-key[data-note="${n}"]`);
      const bKey = document.querySelector(`.black-key[data-note="${n}"]`);
      const strLabels = document.querySelectorAll(`.string-label[data-note="${n}"]`);

      if (on) {
        if (sphere) { sphere.classList.add('playing'); }
        if (wKey) { wKey.classList.add('playing'); wKey.style.background = colors[n]; wKey.style.boxShadow = `0 0 20px ${colors[n]}`; }
        if (bKey) { bKey.classList.add('playing'); bKey.style.background = colors[n]; bKey.style.boxShadow = `0 0 20px ${colors[n]}`; }
        document.querySelectorAll('.note-dot').forEach(d => {
          if (d.textContent.trim() === noteNamesShort[n]) {
            d.classList.add('playing');
            d.style.boxShadow = `0 0 25px ${colors[n]}, 0 0 40px ${colors[n]}`;
          }
        });
        strLabels.forEach(l => { l.style.color = colors[n]; l.style.textShadow = `0 0 20px ${colors[n]}`; l.style.transform = 'scale(1.5)'; });
      } else {
        if (sphere) { sphere.classList.remove('playing'); }
        if (wKey) { wKey.classList.remove('playing'); wKey.style.background = ''; wKey.style.boxShadow = ''; }
        if (bKey) { bKey.classList.remove('playing'); bKey.style.background = ''; bKey.style.boxShadow = ''; }
        document.querySelectorAll('.note-dot').forEach(d => {
          d.classList.remove('playing');
          d.style.boxShadow = '';
        });
        strLabels.forEach(l => { l.style.color = ''; l.style.textShadow = ''; l.style.transform = ''; });
      }
    }

    function playSelection(mode) {
      if (!audioReady) { alert('Click Start Audio Engine first!'); return; }
      const notes = Array.from(selectedNotes).sort((a, b) => a - b);
      if (!notes.length) { alert('No notes selected! Click some notes first.'); return; }
      const beatDur = 60000 / currentBPM;

      if (mode === 'chord') {
        playChordNotes(notes, 1.5);
      } else if (mode === 'up' || mode === 'scale') {
        const ordered = buildOrderedNotes(notes, 'asc');
        ordered.forEach((no, i) => setTimeout(() => playNote(no.note, no.octave, 0.6), i * beatDur));
        if (mode === 'scale') {
          const rev = [...ordered].reverse();
          rev.forEach((no, i) => setTimeout(() => playNote(no.note, no.octave, 0.6), (ordered.length + i) * beatDur));
          setTimeout(() => clearStaffHighlights(), (ordered.length * 2 * beatDur) + 200);
        } else {
          setTimeout(() => clearStaffHighlights(), (ordered.length * beatDur) + 200);
        }
      } else if (mode === 'down') {
        const ordered = buildOrderedNotes(notes, 'desc');
        ordered.forEach((no, i) => setTimeout(() => playNote(no.note, no.octave, 0.6), i * beatDur));
        setTimeout(() => clearStaffHighlights(), (ordered.length * beatDur) + 200);
      }
    }

    function buildOrderedNotes(notes, dir) {
      const rootIndex = notes.indexOf(rootNote);
      const ordered = [];
      if (rootIndex !== -1) {
        for (let i = rootIndex; i < notes.length; i++) ordered.push({note:notes[i], octave:currentOctave});
        for (let i = 0; i < rootIndex; i++) ordered.push({note:notes[i], octave:currentOctave+1});
      } else {
        notes.forEach(n => ordered.push({note:n, octave:currentOctave}));
      }
      return dir === 'desc' ? ordered.reverse() : ordered;
    }

    function playChordNotes(chordNotes, duration) {
      if (!audioContext || !audioReady) return;
      let ofs = 0;
      const notesToPlay = chordNotes.map((note, i) => {
        if (i > 0 && note < chordNotes[i-1]) ofs++;
        return {note, octave: currentOctave + ofs};
      });
      updateStaffNotation(chordNotes);
      notesToPlay.forEach(({note}) => highlightNote(note, true));
      const now = audioContext.currentTime;
      notesToPlay.forEach(({note, octave}) => {
        const freq = FREQS[note] * Math.pow(2, octave - 4);
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        osc.connect(gain); gain.connect(audioContext.destination);
        osc.frequency.value = freq; osc.type = currentWaveform;
        gain.gain.setValueAtTime(0, now);
        gain.gain.linearRampToValueAtTime(0.25, now + 0.015);
        gain.gain.exponentialRampToValueAtTime(0.01, now + duration);
        osc.start(now); osc.stop(now + duration);
      });
      setTimeout(() => {
        notesToPlay.forEach(({note}) => highlightNote(note, false));
        updateStaffNotation(Array.from(selectedNotes));
      }, duration * 1000);
    }

    function clearStaffHighlights() {
      const svg = document.getElementById('staffSVG');
      if (!svg) return;
      svg.querySelectorAll('ellipse').forEach(e => {
        e.setAttribute('stroke', '#000');
        e.setAttribute('stroke-width', '1');
        e.removeAttribute('filter');
      });
    }

    // â”€â”€ STAFF NOTATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function updateStaffNotation(notes) {
      const svg = document.getElementById('staffSVG');
      if (!svg) return;
      svg.innerHTML = '';

      // Staff lines
      for (let i = 0; i < 5; i++) {
        const line = svgEl('line');
        line.setAttribute('x1', '15'); line.setAttribute('y1', 20 + i * 10);
        line.setAttribute('x2', '205'); line.setAttribute('y2', 20 + i * 10);
        line.setAttribute('stroke', '#000'); line.setAttribute('stroke-width', '1.2');
        svg.appendChild(line);
      }

      // Treble clef
      const clef = svgEl('text');
      clef.setAttribute('x','18'); clef.setAttribute('y','50');
      clef.setAttribute('font-size','40'); clef.setAttribute('font-family','serif');
      clef.textContent = 'ğ„'; clef.setAttribute('fill','#000');
      svg.appendChild(clef);

      // Key signature
      const keySig = keySignatures[rootNote];
      let sigX = 48;
      if (keySig.sharps > 0) {
        const pos = [20,35,15,50,25,60,40];
        for (let i = 0; i < keySig.sharps; i++) {
          const s = svgEl('text');
          s.setAttribute('x', sigX); s.setAttribute('y', pos[i]);
          s.setAttribute('font-size','22'); s.setAttribute('font-weight','bold');
          s.setAttribute('font-family','serif'); s.textContent = 'â™¯'; s.setAttribute('fill','#000');
          svg.appendChild(s); sigX += 10;
        }
      } else if (keySig.flats > 0) {
        const pos = [40,55,45,50,30,35,25];
        for (let i = 0; i < keySig.flats; i++) {
          const s = svgEl('text');
          s.setAttribute('x', sigX); s.setAttribute('y', pos[i]);
          s.setAttribute('font-size','22'); s.setAttribute('font-weight','bold');
          s.setAttribute('font-family','serif'); s.textContent = 'â™­'; s.setAttribute('fill','#000');
          svg.appendChild(s); sigX += 10;
        }
      }

      const notePos = {0:70,1:68,2:65,3:62,4:60,5:55,6:52,7:50,8:47,9:45,10:42,11:40};
      const sortedNotes = [...new Set(notes)].sort((a,b) => a-b);
      if (!sortedNotes.length) return;

      let x = Math.max(70, sigX + 12);
      const noteSpacing = Math.min(22, 140 / (sortedNotes.length || 1));

      sortedNotes.forEach(n => {
        const y = notePos[n];
        if (y === 70) {
          const ll = svgEl('line');
          ll.setAttribute('x1', x-8); ll.setAttribute('y1', 70);
          ll.setAttribute('x2', x+8); ll.setAttribute('y2', 70);
          ll.setAttribute('stroke','#000'); ll.setAttribute('stroke-width','1.2');
          svg.appendChild(ll);
        }
        const nh = svgEl('ellipse');
        nh.setAttribute('cx', x); nh.setAttribute('cy', y);
        nh.setAttribute('rx','6'); nh.setAttribute('ry','5');
        nh.setAttribute('fill', colors[n]); nh.setAttribute('stroke','#000'); nh.setAttribute('stroke-width','1');
        svg.appendChild(nh);

        const stem = svgEl('line');
        if (y > 42) {
          stem.setAttribute('x1', x+5.5); stem.setAttribute('y1', y);
          stem.setAttribute('x2', x+5.5); stem.setAttribute('y2', y-28);
        } else {
          stem.setAttribute('x1', x-5.5); stem.setAttribute('y1', y);
          stem.setAttribute('x2', x-5.5); stem.setAttribute('y2', y+28);
        }
        stem.setAttribute('stroke','#000'); stem.setAttribute('stroke-width','1.8');
        svg.appendChild(stem);

        const lbl = svgEl('text');
        lbl.setAttribute('x', x); lbl.setAttribute('y','85');
        lbl.setAttribute('font-size','10'); lbl.setAttribute('font-weight','bold');
        lbl.setAttribute('text-anchor','middle'); lbl.setAttribute('fill','#000');
        lbl.textContent = noteNamesShort[n];
        svg.appendChild(lbl);
        x += noteSpacing;
      });

      // Title label
      const bg = svgEl('rect');
      bg.setAttribute('x','50'); bg.setAttribute('y','100');
      bg.setAttribute('width','120'); bg.setAttribute('height','28');
      bg.setAttribute('fill','rgba(52,152,219,0.15)'); bg.setAttribute('rx','3');
      svg.appendChild(bg);

      const title = svgEl('text');
      title.setAttribute('x','110'); title.setAttribute('y','113');
      title.setAttribute('font-size','11'); title.setAttribute('font-weight','bold');
      title.setAttribute('text-anchor','middle'); title.setAttribute('fill','#2c3e50');

      let tt = '';
      if (currentLevel === '1') tt = noteNames[rootNote];
      else if (currentLevel === '2' && sortedNotes.length === 2) { const iv = (sortedNotes[1]-sortedNotes[0]+12)%12; tt = intervalNames[iv]; }
      else if (currentLevel === '3') tt = `${noteNames[rootNote]} ${currentTriadSelection}`;
      else if (currentLevel === '4') tt = `${noteNames[rootNote]} ${currentExtendedSelection}`;
      else if (currentLevel === '5') tt = `${noteNames[rootNote]} Pentatonic`;
      else if (currentLevel === '7') tt = `${noteNames[rootNote]} Major`;
      else if (currentLevel === 'minor') tt = `${noteNames[rootNote]} ${currentMinorType}`;
      else if (currentLevel === 'modes') tt = `${noteNames[rootNote]} ${currentModeSelection}`;
      else if (currentLevel === 'harmMajor') { const cd = currentHarmChordType==='7th'?harmonizedMajor7ths[currentHarmDegree]:harmonizedMajorTriads[currentHarmDegree]; tt = `${cd.name} ${cd.quality}`; }
      else if (currentLevel === 'harmMinor') { const cd = currentHarmChordType==='7th'?harmonizedMinor7ths[currentHarmDegree]:harmonizedMinorTriads[currentHarmDegree]; tt = `${cd.name} ${cd.quality}`; }
      else if (currentLevel === 'freeplay') tt = 'Free Play';
      title.textContent = tt;
      svg.appendChild(title);

      const ki = svgEl('text');
      ki.setAttribute('x','110'); ki.setAttribute('y','123');
      ki.setAttribute('font-size','8'); ki.setAttribute('text-anchor','middle');
      ki.setAttribute('fill','#555'); ki.textContent = `Key Signature: ${keySig.name}`;
      svg.appendChild(ki);
    }

    function svgEl(tag) {
      return document.createElementNS('http://www.w3.org/2000/svg', tag);
    }

    // â”€â”€ EAR TRAINING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function generateQuiz() {
      const int = Math.floor(Math.random() * 12);
      currentQuiz = {type:'interval', correct:int, notes:[0,int]};
      document.getElementById('quizQuestion').textContent = 'What interval do you hear?';
      const opts = document.getElementById('quizOptions');
      opts.innerHTML = '';
      const all = [0,1,2,3,4,5,6,7,8,9,10,11].sort(() => Math.random() - 0.5);
      const options = all.slice(0, 4);
      if (!options.includes(int)) options[Math.floor(Math.random() * 4)] = int;
      options.forEach(i => {
        const btn = document.createElement('button');
        btn.className = 'quiz-btn';
        btn.textContent = intervalNames[i];
        btn.type = 'button';
        btn.onclick = () => checkAnswer(i);
        opts.appendChild(btn);
      });
      playQuizSound();
    }

    function playQuizSound() {
      if (!currentQuiz || !audioReady) return;
      currentQuiz.notes.forEach((n, i) => setTimeout(() => playNote(n, 4, 0.8), i * 600));
    }

    function checkAnswer(ans) {
      if (!currentQuiz) return;
      quizTotal++;
      const btns = document.querySelectorAll('.quiz-btn');
      if (ans === currentQuiz.correct) {
        quizCorrect++;
        btns.forEach(b => { if (b.textContent === intervalNames[ans]) b.classList.add('correct'); });
      } else {
        btns.forEach(b => {
          if (b.textContent === intervalNames[ans]) b.classList.add('incorrect');
          if (b.textContent === intervalNames[currentQuiz.correct]) b.classList.add('correct');
        });
      }
      document.getElementById('quizScore').textContent = `Score: ${quizCorrect}/${quizTotal} (${Math.round(quizCorrect/quizTotal*100)}%)`;
      setTimeout(() => generateQuiz(), 2000);
    }

    // â”€â”€ RECORDING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function startRecording() {
      if (!audioReady) { alert('Click Start Audio Engine first!'); return; }
      const btn = document.getElementById('recordBtn');
      const st = document.getElementById('recordingStatus');
      if (!isRecording) {
        isRecording = true;
        recordedNotes = [];
        recordingStartTime = Date.now();
        btn.textContent = 'â¹ Stop';
        btn.classList.add('recording');
        btn.setAttribute('aria-pressed', 'true');
        if (st) st.textContent = 'âº Recording...';
      } else {
        isRecording = false;
        btn.textContent = 'âº Record';
        btn.classList.remove('recording');
        btn.setAttribute('aria-pressed', 'false');
        if (st) st.textContent = `âœ“ Recorded ${recordedNotes.length} notes`;
      }
    }

    function playbackRecording() {
      if (!audioReady || !recordedNotes.length) { alert('No recording to play!'); return; }
      const st = document.getElementById('recordingStatus');
      if (st) st.textContent = 'â–¶ Playing...';
      recordedNotes.forEach(d => setTimeout(() => playNote(d.note, d.octave, d.duration), d.timestamp));
      const last = recordedNotes[recordedNotes.length - 1];
      setTimeout(() => { if (st) st.textContent = `âœ“ ${recordedNotes.length} notes recorded`; }, last.timestamp + 1000);
    }

    function downloadMIDI() {
      if (!recordedNotes.length) { alert('No recording to download!'); return; }
      const midiData = {
        tracks: [{
          name: 'Music Theory Explorer Pro',
          notes: recordedNotes.map(n => ({ pitch: n.note + (n.octave * 12), time: n.timestamp/1000, duration: n.duration, velocity: 80 }))
        }],
        tempo: currentBPM,
        exportedAt: new Date().toISOString()
      };
      const blob = new Blob([JSON.stringify(midiData, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `recording_${new Date().toISOString().slice(0,19).replace(/:/g,'-')}.json`;
      a.click();
      URL.revokeObjectURL(url);
      const st = document.getElementById('recordingStatus');
      if (st) st.textContent = 'ğŸ’¾ Downloaded as JSON';
    }

    // â”€â”€ INTERVAL POPUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function showIntervalInfo(interval) {
      const popup = document.getElementById('intervalPopup');
      if (!popup) return;
      const icons = {0:'ğŸ¯',5:'âœ¨',7:'âœ¨',4:'ğŸ˜Š',9:'ğŸ˜Š',3:'ğŸ˜”',8:'ğŸ˜”',10:'ğŸ˜”',6:'âš¡'};
      const icon = icons[interval] || 'ğŸµ';
      const name = intervalNames[interval] || `Interval ${interval}`;
      const desc = intervalDescriptions[interval] || '';
      const semi = interval === 1 ? '1 semitone' : `${interval} semitones`;
      popup.innerHTML = `
        <div id="intervalPopupTitle" style="font-size:56px;margin-bottom:8px;">${icon}</div>
        <div style="font-family:var(--font-display);font-size:clamp(20px,4vw,32px);font-weight:400;color:var(--accent-gold);margin-bottom:12px;">${name}</div>
        <div id="intervalPopupDesc" style="font-size:clamp(13px,2vw,16px);color:var(--text-secondary);margin-bottom:8px;line-height:1.6;">${desc}</div>
        <div style="font-size:12px;color:var(--text-secondary);margin-bottom:20px;font-style:italic;">${semi} apart</div>
        <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
          <button onclick="document.getElementById('intervalPopup').style.display='none'" type="button"
            style="padding:11px 22px;background:var(--bg-raised);border:1px solid var(--border-glow);border-radius:var(--radius-md);color:var(--text-primary);font-weight:700;cursor:pointer;font-family:var(--font-body);">
            âœ“ Got It
          </button>
          <button onclick="if(window.playSelection)window.playSelection('up')" type="button"
            style="padding:11px 22px;background:linear-gradient(135deg,#27ae60,#1e9953);border:none;border-radius:var(--radius-md);color:white;font-weight:700;cursor:pointer;font-family:var(--font-body);">
            ğŸ”Š Play Again
          </button>
        </div>
      `;
      popup.style.display = 'block';
      popup.focus();
      setTimeout(() => {
        popup.style.transition = 'opacity 0.5s';
        popup.style.opacity = '0';
        setTimeout(() => { popup.style.display = 'none'; popup.style.opacity = '1'; popup.style.transition = ''; }, 500);
      }, 10000);
    }

    // â”€â”€ PATTERN / DISPLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function updatePattern() {
      if (currentLevel === 'freeplay' || currentLevel === '2') return;
      let pattern = [], ints = [];
      switch(currentLevel) {
        case '1': pattern = [rootNote]; ints = [0]; break;
        case '3': ints = triads[currentTriadSelection]; pattern = ints.map(i => (rootNote+i)%12); break;
        case '4': ints = extended[currentExtendedSelection]; pattern = ints.map(i => (rootNote+i)%12); break;
        case '5': ints = scales.majorPentatonic; pattern = ints.map(i => (rootNote+i)%12); break;
        case '7': ints = scales.major; pattern = ints.map(i => (rootNote+i)%12); break;
        case 'minor': ints = scales[currentMinorType]; pattern = ints.map(i => (rootNote+i)%12); break;
        case 'modes': ints = modes[currentModeSelection]; pattern = ints.map(i => (rootNote+i)%12); break;
        case 'harmMajor': {
          const cd = currentHarmChordType==='7th'?harmonizedMajor7ths[currentHarmDegree]:harmonizedMajorTriads[currentHarmDegree];
          ints = cd.intervals; pattern = cd.intervals.map(i => (rootNote+i)%12); break;
        }
        case 'harmMinor': {
          const cd = currentHarmChordType==='7th'?harmonizedMinor7ths[currentHarmDegree]:harmonizedMinorTriads[currentHarmDegree];
          ints = cd.intervals; pattern = cd.intervals.map(i => (rootNote+i)%12); break;
        }
      }
      if (pattern.length) { selectedNotes = new Set(pattern); window.currentPatternIntervals = ints; }
    }

    function updateSphereDisplay() {
      document.querySelectorAll('.sphere').forEach((s, i) => {
        s.classList.remove('active','included','excluded','freeplay-inactive','playing');
        if (currentLevel === 'freeplay') {
          s.classList.add('freeplay-inactive');
          if (selectedNotes.has(i)) { s.style.border = `4px solid ${colors[i]}`; s.style.transform = 'scale(1.15)'; }
          else { s.style.border = ''; s.style.transform = ''; }
        } else if (selectedNotes.has(i)) {
          s.classList.add('included');
          s.style.border = ''; s.style.transform = '';
          if (i === rootNote && currentLevel !== '2') s.classList.add('active');
        } else {
          s.classList.add('excluded');
          s.style.border = ''; s.style.transform = '';
        }
      });
      updatePianoDisplay();
      updateGuitarDisplay();
    }

    function updatePianoDisplay() {
      document.querySelectorAll('.white-key,.black-key').forEach(key => {
        const n = parseInt(key.dataset.note);
        if (selectedNotes.has(n)) {
          key.style.borderColor = colors[n]; key.style.borderWidth = '3px';
          key.style.boxShadow = `0 0 10px ${colors[n]}`;
        } else {
          key.style.borderColor = key.classList.contains('white-key') ? '#444' : '#000';
          key.style.borderWidth = '2px'; key.style.boxShadow = '';
        }
      });
    }

    function updateGuitarDisplay() {
      document.querySelectorAll('.note-dot').forEach(dot => {
        const n = noteNamesShort.indexOf(dot.textContent.trim());
        if (n !== -1 && selectedNotes.has(n)) {
          dot.style.opacity = '1'; dot.style.transform = 'translate(-50%,-50%) scale(1.15)';
          dot.style.borderWidth = '3px'; dot.style.boxShadow = `0 0 12px ${colors[n]}`;
          dot.style.filter = 'none';
        } else {
          dot.style.opacity = '0.12'; dot.style.transform = 'translate(-50%,-50%) scale(0.7)';
          dot.style.borderWidth = '1px'; dot.style.boxShadow = 'none';
          dot.style.filter = 'grayscale(100%)';
        }
      });
      updateStringLabels();
    }

    function updateStringLabels() {
      document.querySelectorAll('.string-label').forEach(lbl => {
        const n = parseInt(lbl.dataset.note);
        if (selectedNotes.has(n)) {
          lbl.style.color = colors[n]; lbl.style.textShadow = `0 0 10px ${colors[n]}`; lbl.style.transform = 'scale(1.3)'; lbl.style.opacity = '1';
        } else {
          lbl.style.color = 'rgba(255,255,255,0.2)'; lbl.style.textShadow = ''; lbl.style.transform = 'scale(1)'; lbl.style.opacity = '0.25';
        }
      });
    }

    function updateControls() {
      const c = document.getElementById('controls');
      if (!c) return;
      c.innerHTML = '';

      if (currentLevel !== 'freeplay' && currentLevel !== '2') addSelect(c, 'Root Note', 'rootSelect', noteNames.map((n,i) => `<option value="${i}"${i===rootNote?' selected':''}>${n}</option>`).join(''), function(e) { rootNote = parseInt(e.target.value); updateDisplay(); if (currentView==='circle') setTimeout(()=>playSelection('chord'),100); });

      if (currentLevel === '3') addSelect(c,'Triad Type','triadSelect',`<option value="major">Major</option><option value="minor">Minor</option><option value="diminished">Diminished</option><option value="augmented">Augmented</option>`, function(e){currentTriadSelection=e.target.value;updateDisplay();setTimeout(()=>playSelection('chord'),200);}, currentTriadSelection);
      if (currentLevel === '4') addSelect(c,'7th Chord Type','extendedSelect',`<option value="major7">Major 7th (Maj7)</option><option value="dominant7">Dominant 7th (7)</option><option value="minor7">Minor 7th (m7)</option><option value="diminished7">Diminished 7th (dim7)</option><option value="augmented7">Augmented 7th (aug7)</option><option value="halfDiminished7">Half-Diminished 7th (Ã¸7)</option><option value="minorMajor7">Minor Major 7th (mMaj7)</option><option value="augmentedMajor7">Augmented Major 7th (augMaj7)</option>`, function(e){currentExtendedSelection=e.target.value;updateDisplay();setTimeout(()=>playSelection('chord'),200);}, currentExtendedSelection);
      if (currentLevel === 'minor') addSelect(c,'Minor Scale Type','minorTypeSelect',`<option value="naturalMinor">Natural Minor</option><option value="harmonicMinor">Harmonic Minor</option><option value="melodicMinor">Melodic Minor</option>`, function(e){currentMinorType=e.target.value;updateDisplay();setTimeout(()=>playSelection('scale'),200);}, currentMinorType);
      if (currentLevel === 'modes') addSelect(c,'Mode','modeSelect',`<option value="ionian">Ionian (Major)</option><option value="dorian">Dorian</option><option value="phrygian">Phrygian</option><option value="lydian">Lydian</option><option value="mixolydian">Mixolydian</option><option value="aeolian">Aeolian (Natural Minor)</option><option value="locrian">Locrian</option>`, function(e){currentModeSelection=e.target.value;updateDisplay();setTimeout(()=>playSelection('scale'),200);}, currentModeSelection);

      if (currentLevel === 'harmMajor' || currentLevel === 'harmMinor') {
        const isMinor = currentLevel === 'harmMinor';
        const dl = isMinor ? ['i - Tonic','iiÂ° - Supertonic','III - Mediant','iv - Subdominant','v - Dominant','VI - Submediant','VII - Subtonic'] : ['I - Tonic','ii - Supertonic','iii - Mediant','IV - Subdominant','V - Dominant','vi - Submediant','viiÂ° - Leading Tone'];
        addSelect(c,'Scale Degree','harmDegreeSelect', dl.map((l,i)=>`<option value="${i}">${l}</option>`).join(''), function(e){currentHarmDegree=parseInt(e.target.value);updateDisplay();setTimeout(()=>playSelection('chord'),200);}, String(currentHarmDegree));
        addSelect(c,'Chord Type','harmTypeSelect',`<option value="triad">Triads (3-note)</option><option value="7th">Seventh Chords (4-note)</option>`, function(e){currentHarmChordType=e.target.value;updateDisplay();setTimeout(()=>playSelection('chord'),200);}, currentHarmChordType);
      }

      addSelect(c,'Waveform','waveformSelect',`<option value="sine">Sine (Pure)</option><option value="square">Square (Hollow)</option><option value="sawtooth">Sawtooth (Bright)</option><option value="triangle">Triangle (Soft)</option>`, function(e){currentWaveform=e.target.value;}, currentWaveform);
    }

    function addSelect(container, label, id, optionsHtml, onChange, defaultVal) {
      const g = document.createElement('div');
      g.className = 'control-group';
      const lbl = document.createElement('label');
      lbl.textContent = label; lbl.setAttribute('for', id);
      const sel = document.createElement('select');
      sel.id = id; sel.innerHTML = optionsHtml;
      if (defaultVal !== undefined) sel.value = defaultVal;
      sel.onchange = onChange;
      g.appendChild(lbl); g.appendChild(sel);
      container.appendChild(g);
    }

    function updateNoteList() {
      const list = document.getElementById('noteList');
      if (!list) return;
      const notes = Array.from(selectedNotes).sort((a,b)=>a-b);
      if (currentLevel === 'freeplay' && !notes.length) {
        list.innerHTML = '<span class="note-badge">Click notes to select!</span>';
      } else if (notes.length === 2 && currentLevel === '2') {
        const iv = (notes[1]-notes[0]+12)%12;
        list.innerHTML = `
          <span class="note-badge" style="background:${colors[notes[0]]};color:${textColors[notes[0]]};">${noteNames[notes[0]]}</span>
          <span class="note-badge" style="font-size:15px;">â†’ ${intervalNames[iv]} â†’</span>
          <span class="note-badge" style="background:${colors[notes[1]]};color:${textColors[notes[1]]};">${noteNames[notes[1]]}</span>
        `;
      } else {
        list.innerHTML = notes.map(n => `<span class="note-badge" style="background:${colors[n]};color:${textColors[n]};">${noteNames[n]}${n===rootNote&&currentLevel!=='freeplay'&&currentLevel!=='2'?' (Root)':''}</span>`).join('');
      }
    }

    function updateView() {
      ['circle','keyboard','guitar','ear'].forEach(v => {
        const panel = document.getElementById(`panel-${v}`);
        if (!panel) return;
        if (v === currentView) {
          panel.removeAttribute('hidden');
          panel.classList.add('active-panel');
        } else {
          panel.setAttribute('hidden', '');
          panel.classList.remove('active-panel');
        }
      });
      updateStaffNotation(Array.from(selectedNotes));

      const pc = document.getElementById('progressionControls');
      if ((currentLevel==='harmMajor'||currentLevel==='harmMinor') && currentView!=='ear') {
        pc.style.display = 'block'; updateProgressionButtons();
      } else { pc.style.display = 'none'; }
    }

    function updateOctaveDisplay() {
      const names = {0:'Octave 0 (Sub-Contra)',1:'Octave 1 (Contra)',2:'Octave 2 (Great)',3:'Octave 3 (Small)',4:'Octave 4 (Middle C)',5:'Octave 5 (Treble)',6:'Octave 6 (High)',7:'Octave 7 (Very High)',8:'Octave 8 (Highest)'};
      const lbl = document.getElementById('octaveLabel');
      if (lbl) lbl.textContent = names[currentOctave];
    }

    function updateDisplay() {
      updatePattern();
      updateSphereDisplay();
      updateControls();
      updateNoteList();
      updateStaffNotation(Array.from(selectedNotes));

      const st = document.getElementById('status');
      if (!st) return;
      if (currentLevel === '1' || currentLevel === '3' || currentLevel === '4' || currentLevel === '5' || currentLevel === '7' || currentLevel === 'minor' || currentLevel === 'modes') {
        st.textContent = `ğŸµ Root: ${noteNames[rootNote]} â€” Click a note to change`;
      } else if (currentLevel === 'harmMajor') {
        const cd = currentHarmChordType==='7th'?harmonizedMajor7ths[currentHarmDegree]:harmonizedMajorTriads[currentHarmDegree];
        st.textContent = `ğŸµ Harmonized ${noteNames[rootNote]} Major: ${cd.name} chord (${cd.quality})`;
      } else if (currentLevel === 'harmMinor') {
        const cd = currentHarmChordType==='7th'?harmonizedMinor7ths[currentHarmDegree]:harmonizedMinorTriads[currentHarmDegree];
        st.textContent = `ğŸµ Harmonized ${noteNames[rootNote]} Natural Minor: ${cd.name} chord (${cd.quality})`;
      } else if (currentLevel === 'freeplay') {
        st.textContent = `ğŸ¹ Free Play â€” ${selectedNotes.size} note${selectedNotes.size!==1?'s':''} selected`;
      } else if (currentLevel === '2') {
        if (selectedNotes.size === 2) {
          const ns = Array.from(selectedNotes).sort((a,b)=>a-b);
          const iv = (ns[1]-ns[0]+12)%12;
          st.textContent = `ğŸ¼ Interval: ${intervalNames[iv]}`;
        } else if (selectedNotes.size === 1) {
          st.textContent = `ğŸ¼ First note: ${noteNames[rootNote]} â€” click second note`;
        } else {
          st.textContent = 'ğŸ¼ Intervals â€” click two notes';
        }
      }
    }

    function updateProgressionButtons() {
      const container = document.getElementById('progressionButtons');
      if (!container) return;
      const isMajor = currentLevel === 'harmMajor';
      const progs = isMajor ? [
        {name:'I-IV-V-I',degrees:[0,3,4,0],desc:'Classic Rock'},
        {name:'I-V-vi-IV',degrees:[0,4,5,3],desc:'Pop Anthem'},
        {name:'I-vi-IV-V',degrees:[0,5,3,4],desc:'50s Doo-Wop'},
        {name:'ii-V-I',degrees:[1,4,0],desc:'Jazz Cadence'},
        {name:'vi-IV-I-V',degrees:[5,3,0,4],desc:'Emotional'},
        {name:'I-IV-vi-V',degrees:[0,3,5,4],desc:'Sensitive'}
      ] : [
        {name:'i-iv-v',degrees:[0,3,4],desc:'Minor Blues'},
        {name:'i-VI-VII',degrees:[0,5,6],desc:'Natural Minor'},
        {name:'i-iv-VII',degrees:[0,3,6],desc:'Dorian Feel'},
        {name:'i-III-VI-VII',degrees:[0,2,5,6],desc:'Dark Journey'},
        {name:'i-VI-III-VII',degrees:[0,5,2,6],desc:'Epic Minor'},
        {name:'i-v-VI-iv',degrees:[0,4,5,3],desc:'Melancholic'}
      ];
      container.innerHTML = '';
      progs.forEach(prog => {
        const btn = document.createElement('button');
        btn.className = 'level-btn';
        btn.setAttribute('role', 'listitem');
        btn.type = 'button';
        btn.setAttribute('aria-label', `Play progression ${prog.name} â€” ${prog.desc}`);
        btn.style.cssText = 'padding:10px 14px;font-size:11px;min-width:auto;';
        btn.innerHTML = `${prog.name}<br><small style="opacity:0.8;font-size:9px;">${prog.desc}</small>`;
        btn.onclick = () => playProgression(prog.degrees);
        container.appendChild(btn);
      });
    }

    function playProgression(degrees) {
      if (!audioReady) { alert('Click Start Audio Engine first!'); return; }
      const isMajor = currentLevel === 'harmMajor';
      const use7th = currentHarmChordType === '7th';
      const chordData = isMajor ? (use7th ? harmonizedMajor7ths : harmonizedMajorTriads) : (use7th ? harmonizedMinor7ths : harmonizedMinorTriads);
      const chordDur = 60000 / currentBPM;
      degrees.forEach((degree, index) => {
        setTimeout(() => {
          currentHarmDegree = degree;
          const chord = chordData[degree];
          const pitches = chord.intervals.map(i => (rootNote + i) % 12);
          selectedNotes = new Set(pitches);
          updateSphereDisplay();
          updateNoteList();
          updateStaffNotation(pitches);
          const st = document.getElementById('status');
          if (st) st.textContent = `ğŸµ Playing: ${chord.name} (${chord.quality}) â€” Chord ${index+1}/${degrees.length}`;
          playChordWithIntervals(chord.intervals, chordDur / 1000 * 0.9);
        }, index * chordDur);
      });
    }

    function playChordWithIntervals(intervals, duration) {
      if (!audioContext || !audioReady) return;
      const notesToPlay = intervals.map(interval => ({
        note: (rootNote + interval) % 12,
        octave: currentOctave + Math.floor(interval / 12)
      }));
      const pitches = [...new Set(notesToPlay.map(n => n.note))];
      updateStaffNotation(pitches);
      pitches.forEach(n => highlightNote(n, true));
      const now = audioContext.currentTime;
      notesToPlay.forEach(({note, octave}) => {
        const freq = FREQS[note] * Math.pow(2, octave - 4);
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        osc.connect(gain); gain.connect(audioContext.destination);
        osc.frequency.value = freq; osc.type = currentWaveform;
        gain.gain.setValueAtTime(0, now);
        gain.gain.linearRampToValueAtTime(0.25, now + 0.015);
        gain.gain.exponentialRampToValueAtTime(0.01, now + duration);
        osc.start(now); osc.stop(now + duration);
      });
      setTimeout(() => pitches.forEach(n => highlightNote(n, false)), duration * 1000);
    }

    function playAllScaleChords() {
      if (!audioReady) { alert('Click Start Audio Engine first!'); return; }
      playProgression([0,1,2,3,4,5,6]);
    }

    // â”€â”€ RESPONSIVE CIRCLE RESIZE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function resizeCircle() {
      const circle = document.getElementById('chromaticCircle');
      if (!circle) return;
      const spheres = circle.querySelectorAll('.sphere');
      if (!spheres.length) return;
      const r = circle.offsetWidth / 2;
      const radius = r * 0.77;
      spheres.forEach((s, i) => {
        const angle = (i * 30 - 90) * (Math.PI / 180);
        const x = r + radius * Math.cos(angle);
        const y = r + radius * Math.sin(angle);
        const sz = Math.max(40, Math.min(68, r * 0.145));
        s.style.left = (x - sz/2) + 'px';
        s.style.top = (y - sz/2) + 'px';
        s.style.width = sz + 'px';
        s.style.height = sz + 'px';
        s.style.fontSize = s.textContent.includes('\n') ? Math.max(8, sz*0.17) + 'px' : Math.max(10, sz*0.22) + 'px';
      });
    }

    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => { resizeCircle(); createPiano(); }, 200);
    });

    // â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }

  })();
  </script>
</body>
</html>
